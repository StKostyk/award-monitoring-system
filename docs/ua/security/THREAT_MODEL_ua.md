# Модель Загроз
## Система Моніторингу та Відстеження Нагород - STRIDE Аналіз

> **Етап 10 Результат**: Архітектура Безпеки та Проектування Конфіденційності  
> **Версія Документа**: 1.0  
> **Останнє Оновлення**: Грудень 2025  
> **Автор**: Стефан Костик  
> **Методологія**: STRIDE Моделювання Загроз  
> **Класифікація**: Внутрішній

---

## Резюме

Цей документ представляє комплексну модель загроз для Системи Моніторингу та Відстеження Нагород з використанням методології STRIDE. Аналіз визначає потенційні загрози для всіх компонентів системи, оцінює їх рівні ризику та визначає відповідні заходи пом'якшення для забезпечення безпеки та цілісності системи.

### Цілі Моделювання Загроз

| **Ціль** | **Опис** | **Результат** |
|----------|----------|---------------|
| **Ідентифікація Активів** | Каталогізація всіх цінних активів системи | Повний інвентар активів |
| **Ідентифікація Загроз** | Систематична ідентифікація загроз за STRIDE | Комплексний каталог загроз |
| **Оцінка Ризиків** | Оцінка ймовірності та впливу загроз | Пріоритетний список загроз за ризиком |
| **Визначення Пом'якшень** | Документування контролів безпеки | План впровадження контролів |
| **Валідація Безпеки** | Забезпечення адекватного захисту | Гарантія безпеки |

---

## 1. Ідентифікація Активів Системи

### 1.1 Категорії Активів

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           АКТИВИ СИСТЕМИ                                    │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                        АКТИВИ ДАНИХ                                  │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐│   │
│  │  │ Дані Корист.│  │Дані Нагород │  │ Документи   │  │ Аудит Логи  ││   │
│  │  │ - PII       │  │ - Записи    │  │ - Сертиф.   │  │ - Дії       ││   │
│  │  │ - Облікові  │  │ - Метадані  │  │ - Скани     │  │ - Доступ    ││   │
│  │  │ - Профілі   │  │ - Історія   │  │ - Докази    │  │ - Зміни     ││   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘│   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                       СИСТЕМНІ АКТИВИ                               │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐│   │
│  │  │ Auth Токени │  │ API Ключі   │  │ Ключі       │  │ Сертифікати ││   │
│  │  │ - JWT       │  │ - Сервісні  │  │ Шифрування  │  │ - TLS       ││   │
│  │  │ - Refresh   │  │ - Зовнішні  │  │ - DEK       │  │ - mTLS      ││   │
│  │  │ - Сесійні   │  │ - Адмін     │  │ - KEK       │  │ - Підписання││   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘│   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                    ІНФРАСТРУКТУРНІ АКТИВИ                           │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐│   │
│  │  │ Сервери     │  │ Бази Даних  │  │ Сховище     │  │ Мережі      ││   │
│  │  │ - Застосунок│  │ - PostgreSQL│  │ - S3/Blob   │  │ - VPC       ││   │
│  │  │ - Кеш       │  │ - Redis     │  │ - Резервні  │  │ - Підмережі ││   │
│  │  │ - Повідомл. │  │ - Пошук     │  │ - Логи      │  │ - Фаєрвол   ││   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘│   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 1.2 Класифікація Критичності Активів

| **Актив** | **Конфіденційність** | **Цілісність** | **Доступність** | **Загальна Критичність** |
|-----------|----------------------|----------------|-----------------|--------------------------|
| Облікові Дані Користувачів | Критична | Критична | Висока | **Критична** |
| Персональні Дані (PII) | Критична | Висока | Середня | **Критична** |
| Записи Нагород | Середня | Критична | Висока | **Висока** |
| Підтверджуючі Документи | Висока | Висока | Середня | **Висока** |
| Аудит Логи | Середня | Критична | Висока | **Висока** |
| Токени Автентифікації | Критична | Критична | Висока | **Критична** |
| Ключі Шифрування | Критична | Критична | Критична | **Критична** |
| Конфігурація Системи | Висока | Критична | Висока | **Висока** |
| API Ендпоінти | Низька | Висока | Критична | **Висока** |
| Резервні Дані | Критична | Висока | Середня | **Висока** |

---

## 2. STRIDE Аналіз Загроз

### 2.1 Огляд Методології STRIDE

| **Категорія** | **Визначення** | **Порушена Властивість Безпеки** | **Приклад Загрози** |
|---------------|----------------|----------------------------------|---------------------|
| **S**poofing (Підробка) | Видавання себе за когось/щось інше | Автентифікація | Викрадені облікові дані |
| **T**ampering (Фальсифікація) | Модифікація даних або коду | Цілісність | SQL ін'єкція |
| **R**epudiation (Відмова) | Заперечення виконаних дій | Неспростовність | Відсутні аудит логи |
| **I**nformation Disclosure (Розкриття) | Розкриття інформації | Конфіденційність | Витік даних |
| **D**enial of Service (Відмова в Обслуг.) | Недоступність системи | Доступність | DDoS атака |
| **E**levation of Privilege (Ескалація) | Отримання несанкц. доступу | Авторизація | Ескалація привілеїв |

### 2.2 Компонентний Аналіз Загроз

#### 2.2.1 Рівень Веб-Застосунку

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                    ЗАГРОЗИ ВЕБ-ЗАСТОСУНКУ                                   │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  Компонент: Angular Frontend + API Gateway                                  │
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │  ПІДРОБКА (SPOOFING)                                                │   │
│  │  ├── Викрадення сесії через XSS                                    │   │
│  │  ├── Крадіжка cookie                                               │   │
│  │  └── Фішинг атаки                                                  │   │
│  │                                                                      │   │
│  │  ФАЛЬСИФІКАЦІЯ (TAMPERING)                                          │   │
│  │  ├── Маніпуляція DOM                                               │   │
│  │  ├── Підробка параметрів запиту                                    │   │
│  │  └── Обхід клієнтської валідації                                   │   │
│  │                                                                      │   │
│  │  РОЗКРИТТЯ ІНФОРМАЦІЇ (INFORMATION DISCLOSURE)                      │   │
│  │  ├── Чутливі дані в browser storage                                │   │
│  │  ├── Витік даних API відповіді                                     │   │
│  │  └── Розкриття через повідомлення помилок                          │   │
│  │                                                                      │   │
│  │  ВІДМОВА В ОБСЛУГОВУВАННІ (DENIAL OF SERVICE)                       │   │
│  │  ├── Атаки вичерпання ресурсів                                     │   │
│  │  ├── DDoS на рівні застосунку                                      │   │
│  │  └── Обхід обмеження швидкості                                     │   │
│  │                                                                      │   │
│  │  ЕСКАЛАЦІЯ ПРИВІЛЕЇВ (ELEVATION OF PRIVILEGE)                       │   │
│  │  ├── CSRF атаки                                                    │   │
│  │  ├── Clickjacking                                                  │   │
│  │  └── Маніпуляція ролями на клієнті                                 │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

#### 2.2.2 Сервіс Автентифікації

| **Категорія Загрози** | **ID Загрози** | **Опис Загрози** | **Вектор Атаки** | **Вплив** |
|-----------------------|----------------|------------------|------------------|-----------|
| **Підробка** | S-AUTH-01 | Credential stuffing | Автоматизовані спроби входу | Захоплення акаунту |
| **Підробка** | S-AUTH-02 | Brute force атака | Підбір пароля | Несанкціонований доступ |
| **Підробка** | S-AUTH-03 | Підробка токена | Маніпуляція JWT | Підробка ідентичності |
| **Фальсифікація** | T-AUTH-01 | Replay атака токена | Повторне використання токена | Викрадення сесії |
| **Фальсифікація** | T-AUTH-02 | Обхід MFA | Недоліки впровадження MFA | Обхід автентифікації |
| **Відмова** | R-AUTH-01 | Заперечення дії входу | Відсутність аудит слідів | Втрата підзвітності |
| **Розкриття** | I-AUTH-01 | Розкриття хешу пароля | Злам бази даних | Компрометація облікових даних |
| **Розкриття** | I-AUTH-02 | Витік токена в логах | Недостатня санітизація логів | Викрадення сесії |
| **DoS** | D-AUTH-01 | Flooding сервісу автент. | Масові запити автентифікації | Недоступність сервісу |
| **Ескалація** | E-AUTH-01 | Маніпуляція ролей в claims | Підробка payload JWT | Ескалація привілеїв |

#### 2.2.3 Сервіс Нагород

| **Категорія Загрози** | **ID Загрози** | **Опис Загрози** | **Вектор Атаки** | **Вплив** |
|-----------------------|----------------|------------------|------------------|-----------|
| **Підробка** | S-AWARD-01 | Підробка подання нагороди | Імітація користувача | Шахрайські нагороди |
| **Фальсифікація** | T-AWARD-01 | Маніпуляція даними нагороди | Пряма модифікація БД | Втрата цілісності даних |
| **Фальсифікація** | T-AWARD-02 | Обхід workflow затвердження | Маніпуляція логікою | Несанкціоновані затвердження |
| **Фальсифікація** | T-AWARD-03 | Фальсифікація документів | Заміна файлів | Маніпуляція доказами |
| **Відмова** | R-AWARD-01 | Заперечення затвердження | Недостатнє логування | Невдача вирішення спорів |
| **Розкриття** | I-AWARD-01 | Несанкц. доступ до нагороди | IDOR вразливість | Порушення конфіденційності |
| **DoS** | D-AWARD-01 | Масове подання | Автоматизовані подання | Перевантаження системи |
| **Ескалація** | E-AWARD-01 | Самозатвердження | Обхід авторизації | Втрата цілісності процесу |

#### 2.2.4 Рівень Бази Даних

| **Категорія Загрози** | **ID Загрози** | **Опис Загрози** | **Вектор Атаки** | **Вплив** |
|-----------------------|----------------|------------------|------------------|-----------|
| **Підробка** | S-DB-01 | Підробка користувача БД | Крадіжка облікових даних | Несанкціонований доступ |
| **Фальсифікація** | T-DB-01 | SQL ін'єкція | Некоректний ввід | Маніпуляція даними |
| **Фальсифікація** | T-DB-02 | Пряма модифікація записів | Зловживання привіл. доступом | Втрата цілісності даних |
| **Відмова** | R-DB-01 | Заперечення транзакції | Вимкнене логування | Невдача аудиту |
| **Розкриття** | I-DB-01 | Розкриття дампу БД | Крадіжка резервної копії | Масовий витік даних |
| **Розкриття** | I-DB-02 | Витік результатів запиту | Повідомлення помилок | Розкриття схеми |
| **DoS** | D-DB-01 | Вичерпання пулу з'єднань | Масові з'єднання | Порушення сервісу |
| **DoS** | D-DB-02 | Ресурсоємні запити | Query ін'єкція | Деградація продуктивності |
| **Ескалація** | E-DB-01 | Ескалація привілеїв | SQL ін'єкція | Повний доступ до БД |

---

## 3. Детальні Сценарії Загроз

### 3.1 Критичні Сценарії Загроз

#### Сценарій 1: Атака Захоплення Акаунту

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                    СЦЕНАРІЙ ЗАГРОЗИ: ЗАХОПЛЕННЯ АКАУНТУ                     │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  Ланцюг Атаки:                                                              │
│                                                                             │
│  ┌──────────┐    ┌──────────┐    ┌──────────┐    ┌──────────┐             │
│  │ Фішинг   │───▶│ Збір     │───▶│Викрадення│───▶│Захоплення│             │
│  │ Email    │    │ Облікових│    │ Сесії    │    │ Акаунту  │             │
│  └──────────┘    └──────────┘    └──────────┘    └──────────┘             │
│                                                                             │
│  Деталі Загрози:                                                            │
│  - Категорія STRIDE: Підробка                                              │
│  - ID Загрози: S-AUTH-04                                                   │
│  - Ймовірність: Середня                                                    │
│  - Вплив: Критичний                                                        │
│  - Оцінка Ризику: 8/10                                                     │
│                                                                             │
│  Кроки Атаки:                                                               │
│  1. Зловмисник надсилає фішинг email, що імітує системне сповіщення       │
│  2. Користувач переходить за посиланням та вводить облікові дані          │
│  3. Зловмисник використовує викрадені облікові дані для автентифікації    │
│  4. Зловмисник отримує доступ до акаунту та даних користувача             │
│  5. Зловмисник може ескалювати до інших акаунтів або систем               │
│                                                                             │
│  Пом'якшення:                                                               │
│  ├── MFA обов'язковий для всіх користувачів                               │
│  ├── Верифікація email домену (SPF, DKIM, DMARC)                          │
│  ├── Навчання користувачів з безпеки                                      │
│  ├── Виявлення аномалій входу                                             │
│  ├── Fingerprinting сесії                                                 │
│  └── Моніторинг витоку паролів (HaveIBeenPwned)                           │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

#### Сценарій 2: Маніпуляція Даними Нагород

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                  СЦЕНАРІЙ ЗАГРОЗИ: МАНІПУЛЯЦІЯ ДАНИМИ НАГОРОД               │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  Ланцюг Атаки:                                                              │
│                                                                             │
│  ┌──────────┐    ┌──────────┐    ┌──────────┐    ┌──────────┐             │
│  │ SQL      │───▶│ Обхід    │───▶│ Модифік. │───▶│ Втрата   │             │
│  │ Ін'єкція │    │ Автент.  │    │ Даних    │    │Цілісності│             │
│  └──────────┘    └──────────┘    └──────────┘    └──────────┘             │
│                                                                             │
│  Деталі Загрози:                                                            │
│  - Категорія STRIDE: Фальсифікація                                         │
│  - ID Загрози: T-AWARD-01                                                  │
│  - Ймовірність: Низька (з належними контролями)                            │
│  - Вплив: Критичний                                                        │
│  - Оцінка Ризику: 7/10                                                     │
│                                                                             │
│  Кроки Атаки:                                                               │
│  1. Зловмисник виявляє поле вводу вразливе до SQL ін'єкції                │
│  2. Зловмисник формує шкідливий SQL payload                               │
│  3. Застосунок виконує непередбачені SQL команди                          │
│  4. Зловмисник модифікує записи нагород (статус, дати, отримувачі)        │
│  5. Шахрайські нагороди виглядають легітимними                            │
│                                                                             │
│  Пом'якшення:                                                               │
│  ├── Параметризовані запити (JPA/Hibernate)                               │
│  ├── Валідація та санітизація вводу                                       │
│  ├── Користувач БД з мінімальними привілеями                              │
│  ├── Фаєрвол веб-застосунків з правилами SQL ін'єкції                    │
│  ├── Моніторинг активності бази даних                                     │
│  └── Аудит слід змін нагород з цифровими підписами                        │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

#### Сценарій 3: Витік Даних через API

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                    СЦЕНАРІЙ ЗАГРОЗИ: ВИТІК ДАНИХ ЧЕРЕЗ API                  │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  Ланцюг Атаки:                                                              │
│                                                                             │
│  ┌──────────┐    ┌──────────┐    ┌──────────┐    ┌──────────┐             │
│  │ Enum.    │───▶│ Експлуат.│───▶│ Доступ   │───▶│ Масова   │             │
│  │ API      │    │ IDOR     │    │ до Даних │    │ Ексфільтр│             │
│  └──────────┘    └──────────┘    └──────────┘    └──────────┘             │
│                                                                             │
│  Деталі Загрози:                                                            │
│  - Категорія STRIDE: Розкриття Інформації                                  │
│  - ID Загрози: I-API-01                                                    │
│  - Ймовірність: Середня                                                    │
│  - Вплив: Критичний                                                        │
│  - Оцінка Ризику: 8/10                                                     │
│                                                                             │
│  Кроки Атаки:                                                               │
│  1. Зловмисник перелічує API ендпоінти через документацію/discovery       │
│  2. Зловмисник виявляє IDOR вразливість в /api/users/{id}                 │
│  3. Зловмисник ітерує через user ID для доступу до інших профілів         │
│  4. Зловмисник витягує чутливу персональну інформацію                     │
│  5. Масова ексфільтрація даних призводить до порушення GDPR               │
│                                                                             │
│  Пом'якшення:                                                               │
│  ├── UUID замість послідовних ID                                          │
│  ├── Перевірки авторизації на рівні об'єктів                              │
│  ├── Обмеження швидкості на користувача/IP                                │
│  ├── Фільтрація API відповіді на основі дозволів                          │
│  ├── Логування доступу до даних                                           │
│  └── Виявлення аномалій для незвичних патернів доступу                    │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 4. Матриця Оцінки Ризиків

### 4.1 Оцінка Ризиків Загроз

| **ID Загрози** | **Категорія** | **Ймовірність** | **Вплив** | **Оцінка Ризику** | **Пріоритет** |
|----------------|---------------|-----------------|-----------|-------------------|---------------|
| S-AUTH-01 | Підробка | Висока | Критичний | 9 | **P1** |
| I-DB-01 | Розкриття | Низька | Критичний | 7 | **P1** |
| T-DB-01 | Фальсифікація | Середня | Критичний | 8 | **P1** |
| E-AUTH-01 | Ескалація | Середня | Критичний | 8 | **P1** |
| S-AUTH-04 | Підробка | Середня | Критичний | 8 | **P1** |
| T-AWARD-01 | Фальсифікація | Низька | Критичний | 7 | **P2** |
| I-API-01 | Розкриття | Середня | Високий | 7 | **P2** |
| D-AUTH-01 | DoS | Висока | Середній | 6 | **P2** |
| T-AUTH-02 | Фальсифікація | Низька | Високий | 5 | **P3** |
| R-AUTH-01 | Відмова | Низька | Середній | 4 | **P3** |

### 4.2 Теплова Карта Ризиків

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          ТЕПЛОВА КАРТА РИЗИКІВ                              │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ВПЛИВ                                                                      │
│     ▲                                                                       │
│     │                                                                       │
│  Критичний│  Середній   │  Високий    │  КРИТИЧНИЙ  │                      │
│           │  T-AUTH-02  │  I-DB-01    │  S-AUTH-01  │                      │
│           │             │  T-AWARD-01 │  T-DB-01    │                      │
│           │             │             │  E-AUTH-01  │                      │
│     ──────┼─────────────┼─────────────┼─────────────┤                      │
│  Високий  │  Низький    │  Середній   │  Високий    │                      │
│           │  R-AWARD-01 │  I-API-01   │             │                      │
│           │             │             │             │                      │
│     ──────┼─────────────┼─────────────┼─────────────┤                      │
│  Середній │  Низький    │  Середній   │  Середній   │                      │
│           │  R-AUTH-01  │  D-DB-02    │  D-AUTH-01  │                      │
│           │             │             │             │                      │
│     ──────┼─────────────┼─────────────┼─────────────┤                      │
│  Низький  │  Мінімальний│  Низький    │  Низький    │                      │
│           │             │             │             │                      │
│           └─────────────┴─────────────┴─────────────┴────▶ ЙМОВІРНІСТЬ     │
│                Низька      Середня         Висока                          │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 5. Контролі Пом'якшення

### 5.1 Категорії Контролів

| **Тип Контролю** | **Опис** | **Приклади** |
|------------------|----------|--------------|
| **Превентивний** | Зупинення загроз до їх виникнення | Валідація вводу, MFA, шифрування |
| **Детективний** | Виявлення загроз при їх виникненні | Логування, моніторинг, IDS |
| **Коригуючий** | Реагування та виправлення загроз | Реагування на інциденти, патчинг |
| **Стримуючий** | Відлякування зловмисників | Попередження безпеки, юридичні повідомлення |
| **Компенсуючий** | Альтернативні контролі коли основні недоступні | Ручні перевірки, резервування |

### 5.2 Матриця Пом'якшення

| **ID Загрози** | **Основне Пом'якшення** | **Вторинне Пом'якшення** | **Виявлення** | **Реагування** |
|----------------|-------------------------|--------------------------|---------------|----------------|
| S-AUTH-01 | Обмеж. швидкості, Блокування | CAPTCHA, Блокування IP | Моніторинг невдалих входів | Заморозка акаунту |
| S-AUTH-02 | Сильна політика паролів | MFA, Перевірка витоку | Виявлення brute force | Бан IP |
| S-AUTH-04 | MFA, Навчання безпеки | Автентифікація email | Виявлення аномалій входу | Інвалідація сесії |
| T-DB-01 | Параметризовані запити | WAF, Валідація вводу | Виявлення SQL ін'єкції | Блокування запиту |
| T-AWARD-01 | Аудит логування, Checksums | Workflow затвердження | Моніторинг змін | Відновлення даних |
| I-DB-01 | Шифрування у спокої | Контролі доступу | Логування доступу до даних | Сповіщення про витік |
| I-API-01 | Авторизація об'єктів | UUID ідентифікатори | Аналіз патернів доступу | Обмеження швидкості |
| D-AUTH-01 | Обмеження швидкості | Auto-scaling | Моніторинг трафіку | Фільтрація трафіку |
| E-AUTH-01 | Верифікація підпису токена | Валідація ролей | Моніторинг привілеїв | Відкликання токена |

### 5.3 Деталі Впровадження Контролів

#### 5.3.1 Пом'якшення Підробки

```java
// Впровадження Багатофакторної Автентифікації
@Service
public class MfaService {
    
    public MfaChallenge initiateMfaChallenge(User user, AuthenticationContext context) {
        // Визначення MFA на основі ризику
        RiskLevel risk = riskAssessmentService.assessLoginRisk(user, context);
        
        if (risk == RiskLevel.HIGH) {
            // Вимога апаратного ключа для високоризикових входів
            return createHardwareKeyChallenge(user);
        } else if (risk == RiskLevel.MEDIUM) {
            // TOTP для середнього ризику
            return createTotpChallenge(user);
        } else {
            // Email/SMS для низького ризику
            return createEmailChallenge(user);
        }
    }
    
    public boolean verifyMfa(String userId, String challengeId, String response) {
        MfaChallenge challenge = challengeRepository.findById(challengeId)
            .orElseThrow(() -> new InvalidChallengeException("Виклик не знайдено"));
        
        if (challenge.isExpired()) {
            auditService.logFailedMfa(userId, "Виклик закінчився");
            throw new ExpiredChallengeException("MFA виклик закінчився");
        }
        
        boolean verified = switch (challenge.getType()) {
            case TOTP -> totpValidator.validate(challenge.getSecret(), response);
            case EMAIL, SMS -> challenge.getCode().equals(response);
            case HARDWARE_KEY -> fido2Service.verifyAssertion(challenge, response);
        };
        
        if (!verified) {
            auditService.logFailedMfa(userId, "Невірна відповідь");
        }
        
        return verified;
    }
}
```

#### 5.3.2 Пом'якшення Фальсифікації

```java
// Верифікація Цілісності Даних
@Service
public class DataIntegrityService {
    
    @Transactional
    public Award saveAward(Award award) {
        // Обчислення контрольної суми перед збереженням
        String checksum = calculateChecksum(award);
        award.setIntegrityChecksum(checksum);
        
        // Збереження з оптимістичним блокуванням
        Award saved = awardRepository.save(award);
        
        // Логування зміни з контрольною сумою
        auditService.logDataChange(
            AuditAction.AWARD_MODIFIED,
            award.getId(),
            checksum,
            SecurityContextHolder.getContext().getAuthentication()
        );
        
        return saved;
    }
    
    public boolean verifyIntegrity(Award award) {
        String currentChecksum = calculateChecksum(award);
        return currentChecksum.equals(award.getIntegrityChecksum());
    }
    
    private String calculateChecksum(Award award) {
        String dataToHash = award.getTitle() + award.getDate() + 
                          award.getUserId() + award.getStatus();
        return DigestUtils.sha256Hex(dataToHash);
    }
}
```

#### 5.3.3 Пом'якшення Розкриття Інформації

```java
// Шифрування на Рівні Полів для PII
@Entity
@Table(name = "users")
public class User {
    
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    @Column(name = "email_address")
    @Convert(converter = EncryptedStringConverter.class)
    private String emailAddress;  // Шифрується у спокої
    
    @Column(name = "phone_number")
    @Convert(converter = EncryptedStringConverter.class)
    private String phoneNumber;  // Шифрується у спокої
    
    // Публічні поля - шифрування не потрібне
    @Column(name = "display_name")
    private String displayName;
}

@Converter
public class EncryptedStringConverter implements AttributeConverter<String, String> {
    
    @Autowired
    private EncryptionService encryptionService;
    
    @Override
    public String convertToDatabaseColumn(String attribute) {
        if (attribute == null) return null;
        return encryptionService.encrypt(attribute);
    }
    
    @Override
    public String convertToEntityAttribute(String dbData) {
        if (dbData == null) return null;
        return encryptionService.decrypt(dbData);
    }
}
```

#### 5.3.4 Пом'якшення DoS

```java
// Конфігурація Обмеження Швидкості
@Configuration
public class RateLimitingConfig {
    
    @Bean
    public RateLimiter authenticationRateLimiter() {
        return RateLimiter.builder()
            .limitForPeriod(5)  // 5 запитів
            .limitRefreshPeriod(Duration.ofMinutes(1))  // на хвилину
            .timeoutDuration(Duration.ofSeconds(1))
            .build();
    }
    
    @Bean
    public RateLimiter apiRateLimiter() {
        return RateLimiter.builder()
            .limitForPeriod(100)  // 100 запитів
            .limitRefreshPeriod(Duration.ofMinutes(1))  // на хвилину
            .timeoutDuration(Duration.ofSeconds(5))
            .build();
    }
}

@Aspect
@Component
public class RateLimitingAspect {
    
    @Around("@annotation(RateLimited)")
    public Object rateLimit(ProceedingJoinPoint joinPoint) throws Throwable {
        String key = extractRateLimitKey(joinPoint);
        
        if (!rateLimiter.acquirePermission(key)) {
            auditService.logRateLimitExceeded(key);
            throw new TooManyRequestsException("Ліміт запитів перевищено");
        }
        
        return joinPoint.proceed();
    }
}
```

#### 5.3.5 Пом'якшення Ескалації Привілеїв

```java
// Авторизація на Рівні Методів
@Service
public class AwardApprovalService {
    
    @PreAuthorize("hasRole('DEAN') or hasRole('RECTOR')")
    public void approveAward(Long awardId) {
        Award award = awardRepository.findById(awardId)
            .orElseThrow(() -> new NotFoundException("Нагороду не знайдено"));
        
        User currentUser = getCurrentUser();
        
        // Запобігання самозатвердженню
        if (award.getSubmitterId().equals(currentUser.getId())) {
            auditService.logSecurityViolation(
                "Спроба самозатвердження", 
                currentUser.getId(), 
                awardId
            );
            throw new SecurityException("Неможливо затвердити власне подання нагороди");
        }
        
        // Перевірка рівня повноважень відповідає категорії нагороди
        if (!hasAuthorityForCategory(currentUser, award.getCategory())) {
            throw new AccessDeniedException("Недостатньо повноважень для цієї категорії");
        }
        
        // Обробка затвердження
        award.setStatus(AwardStatus.APPROVED);
        award.setApprovedBy(currentUser.getId());
        award.setApprovedAt(Instant.now());
        
        awardRepository.save(award);
        auditService.logApproval(award, currentUser);
    }
}
```

---

## 6. Моніторинг та Виявлення Загроз

### 6.1 Правила Моніторингу Безпеки

| **ID Правила** | **Виявлена Загроза** | **Логіка Виявлення** | **Серйозність Сповіщення** |
|----------------|----------------------|----------------------|---------------------------|
| SEC-001 | Brute force атака | >10 невдалих входів за 5 хв з одного IP | Висока |
| SEC-002 | Credential stuffing | >100 унікальних спроб входу з одного IP | Критична |
| SEC-003 | Ескалація привілеїв | Зміна ролі без належного затвердження | Критична |
| SEC-004 | Ексфільтрація даних | >1000 записів доступ за 1 годину одним користувачем | Висока |
| SEC-005 | Спроба SQL ін'єкції | SQL ключові слова в параметрах вводу | Середня |
| SEC-006 | Replay токена | Той самий токен з різних IP | Висока |
| SEC-007 | Незвичний патерн доступу | Доступ поза звичайними годинами/локацією | Середня |
| SEC-008 | Спроба масового видалення | >10 операцій видалення за 1 хвилину | Критична |

### 6.2 Впровадження Виявлення

```yaml
# Правила Безпеки Elasticsearch
security_rules:
  - name: "Виявлення Brute Force"
    type: "threshold"
    index: "audit-logs-*"
    query: "action:LOGIN_FAILED"
    group_by: "source_ip"
    threshold: 10
    time_window: "5m"
    severity: "high"
    actions:
      - type: "alert"
        channel: "security-team"
      - type: "block_ip"
        duration: "1h"
        
  - name: "Виявлення Ексфільтрації Даних"
    type: "threshold"
    index: "audit-logs-*"
    query: "action:DATA_ACCESS AND entity_type:users"
    group_by: "user_id"
    threshold: 1000
    time_window: "1h"
    severity: "high"
    actions:
      - type: "alert"
        channel: "security-team"
      - type: "suspend_session"
```

---

## 7. Оцінка Залишкового Ризику

### 7.1 Рівні Ризику Після Пом'якшення

| **ID Загрози** | **Початковий Ризик** | **Застосовані Пом'якшення** | **Залишковий Ризик** | **Прийнятний** |
|----------------|----------------------|------------------------------|---------------------|----------------|
| S-AUTH-01 | Високий (9) | MFA, Обмеж. швидкості, Блокування | Низький (3) | ✅ Так |
| T-DB-01 | Високий (8) | Параметризовані запити, WAF | Дуже Низький (2) | ✅ Так |
| I-DB-01 | Високий (7) | Шифрування, Контролі доступу | Низький (3) | ✅ Так |
| E-AUTH-01 | Високий (8) | Підписання токенів, Валідація ролей | Низький (3) | ✅ Так |
| I-API-01 | Середній (7) | Авторизація, UUID | Низький (4) | ✅ Так |

### 7.2 Критерії Прийняття Ризику

| **Рівень Ризику** | **Діапазон Оцінки** | **Орган Прийняття** | **Частота Перегляду** |
|-------------------|---------------------|---------------------|----------------------|
| Дуже Низький | 1-2 | Команда Безпеки | Щорічно |
| Низький | 3-4 | Менеджер Безпеки | Щоквартально |
| Середній | 5-6 | CISO / Спонсор Проекту | Щомісяця |
| Високий | 7-8 | Виконавче Керівництво | Негайна ескалація |
| Критичний | 9-10 | Неприйнятний | Має бути пом'якшений |

---

## 8. Підтримка Моделі Загроз

### 8.1 Графік Перегляду

| **Тригер** | **Тип Перегляду** | **Область** | **Відповідальний** |
|------------|-------------------|-------------|-------------------|
| Реліз нової функції | Інкрементальний | Задіяні компоненти | Команда Розробки |
| Інцидент безпеки | Цільовий | Компоненти пов'язані з інцидентом | Команда Безпеки |
| Річний графік | Повний | Повна система | Команда Безпеки |
| Велика зміна архітектури | Повний | Повна система | Архітектурна Рада |
| Нова threat intelligence | Цільовий | Релевантні загрози | Команда Безпеки |

### 8.2 Процес Оновлення Моделі Загроз

1. **Ідентифікація Змін** - Документування змін системи або нової розвідки
2. **Оновлення Активів** - Перегляд інвентарю активів за потреби
3. **Аналіз Загроз** - Застосування STRIDE до нових/змінених компонентів
4. **Оцінка Ризиків** - Оцінка нових загроз
5. **Визначення Пом'якшень** - Визначення контролів для нових загроз
6. **Оновлення Документації** - Перегляд цієї моделі загроз
7. **Валідація Контролів** - Тестування ефективності пом'якшень
8. **Комунікація Змін** - Сповіщення зацікавлених сторін

---

## Пов'язані Документи

- **Етап 10**: [Архітектура Безпеки](./SECURITY_ARCHITECTURE_ua.md)
- **Етап 10**: [Автентифікація та Авторизація](./AUTHENTICATION_AUTHORIZATION_ua.md)
- **Етап 10**: [Privacy by Design](./PRIVACY_BY_DESIGN_ua.md)
- **Етап 6**: [Фреймворк Безпеки](../compliance/SECURITY_FRAMEWORK_ua.md)

---

*Версія Документа: 1.0*  
*Класифікація: Внутрішній*  
*Етап: 10 - Архітектура Безпеки та Проектування Конфіденційності*  
*Автор: Стефан Костик*

