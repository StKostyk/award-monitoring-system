# ADR-011: Вибір рішення моніторингу

**Статус**: Прийнято  
**Дата**: 2025-08-21  
**Автор**: Стефан Костик  
**Зацікавлені сторони**: Архітектор проекту, Команда операцій, Команда розробки

---

## Контекст

Система моніторингу та відстеження нагород потребує комплексного моніторингу для метрик додатка, відстеження продуктивності та операційних інсайтів. Це включає бізнес-метрики, технічні метрики та можливості сповіщення.

### Передумови
- Моніторинг продуктивності додатка та сповіщення
- Відстеження бізнес-метрик (оброблені нагороди, активність користувачів)
- Моніторинг інфраструктури для використання ресурсів
- Економічно ефективне рішення для проекту одного розробника

---

## Рішення

**Micrometer + Prometheus** було обрано як рішення моніторингу для Системи моніторингу та відстеження нагород.

### Обраний підхід
- **Збір метрик**: Micrometer як фасад метрик
- **Зберігання метрик**: Prometheus для зберігання часових рядів
- **Візуалізація**: Grafana для дашбордів та візуалізації
- **Сповіщення**: Prometheus Alertmanager для повідомлень

### Обґрунтування
- **Інтеграція Spring**: Micrometer вбудований в Spring Boot Actuator
- **Open Source**: Економічно ефективний стек моніторингу
- **Гнучкість**: Vendor-neutral збір метрик з Micrometer
- **Екосистема**: Багата екосистема з Grafana та інструментами сповіщення
- **Self-Hosted**: Повний контроль над інфраструктурою моніторингу

---

## Наслідки

### Позитивні наслідки
- **Нульова вартість ліцензування**: Open source стек моніторингу
- **Комплексні метрики**: Збір метрик додатка та бізнесу
- **Моніторинг в реальному часі**: Майже реальний час метрик та сповіщення
- **Налаштовувані дашборди**: Гнучка візуалізація з Grafana

### Негативні наслідки
- **Накладні витрати інфраструктури**: Додаткові компоненти для розгортання та обслуговування
- **Крива навчання**: Мова запитів Prometheus (PromQL)
- **Управління сховищем**: Планування зберігання та утримання даних Prometheus

---

## Розглянуті альтернативи

### Альтернатива 1: New Relic / DataDog
- **Переваги**: Керований сервіс, комплексні функції, легке налаштування
- **Недоліки**: Щомісячні витрати на підписку, vendor lock-in
- **Причина відхилення**: Міркування витрат для портфоліо проекту

### Альтернатива 2: ELK Stack (Elasticsearch, Logstash, Kibana)
- **Переваги**: Комплексне логування та моніторинг, потужний пошук
- **Недоліки**: Ресурсомісткий, складне налаштування, більше підходить для логування
- **Причина відхилення**: Надмірно для потреб моніторингу метрик

---

## Примітки з реалізації

### Технічні вимоги
- **Версія Micrometer**: 1.12+ (включено в Spring Boot 3.x)
- **Версія Prometheus**: 2.45+ для останніх функцій
- **Версія Grafana**: 10.0+ для сучасного UI та функцій
- **Сховище**: Мінімум 10GB для зберігання метрик

### Конфігурація метрик
```yaml
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  endpoint:
    health:
      show-details: always
  metrics:
    export:
      prometheus:
        enabled: true
```

### Ключові метрики
- **Метрики додатка**: HTTP запити, час відповіді, рівень помилок
- **Бізнес-метрики**: Створені нагороди, зареєстровані користувачі, оброблені документи
- **JVM метрики**: Використання пам'яті, збір сміття, пули потоків
- **Метрики бази даних**: Використання пулу з'єднань, час виконання запитів

### Правила сповіщення
- Високий рівень помилок (> 5% за 5 хвилин)
- Погіршення часу відповіді (P99 > 2 секунди)
- Поріг використання пам'яті (> 90%)
- Вичерпання пулу з'єднань бази даних

---

## Метрики успіху

- **Збір метрик**: 100% uptime для збору метрик
- **Відповідь на сповіщення**: < 2 хвилин час повідомлення для критичних сповіщень
- **Час завантаження дашборду**: < 3 секунди для дашбордів Grafana

---

## Пов'язані документи

- **Технічний стек**: [Вибір технологічного стеку](../TECH_STACK_ua.md)
- **Шаблони інтеграції**: [Корпоративні шаблони інтеграції](../INTEGRATION_PATTERNS_ua.md)
- **Зовнішні ресурси**: [Документація Micrometer](https://micrometer.io/docs)

---

## Історія версій

| **Дата** | **Автор** | **Зміни** | **Причина** |
|----------|------------|-------------|------------|
| 2025-08-21 | Стефан Костик | Початкова версія | Створення документа |

---

**Статус документа**: Затверджено  
**Дата наступного огляду**: 2026-02-21  
**Категорія ADR**: Технологія 