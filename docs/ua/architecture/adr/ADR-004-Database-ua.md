# ADR-004: Вибір бази даних

**Статус**: Прийнято  
**Дата**: 2025-08-20  
**Автор**: Стефан Костик  
**Зацікавлені сторони**: Архітектор проекту, Команда даних, Команда операційного відділу

---

## Контекст

Система моніторингу та відстеження нагород потребує надійної, масштабованої бази даних, яка може обробляти складні реляційні дані, підтримувати вимоги відповідності GDPR та забезпечувати відмінну продуктивність як для транзакційних, так і для аналітичних навантажень.

### Передумови
- Складна реляційна модель даних з користувачами, нагородами, інституціями та документами
- Відповідність GDPR, що вимагає журналів аудиту та політик зберігання даних
- Потреба в можливостях повнотекстового пошуку для контенту нагород та документів
- Вимога зберігання JSON даних для гнучких метаданих документів
- Підтримка багатомовності для українського та англійського контенту
- Майбутні вимоги аналітики та звітності

### Припущення
- Реляційна модель даних підходить для домену
- Експертиза PostgreSQL цінна для демонстрації портфоліо
- Перевага open-source рішення з міркувань економічності
- Сумісність з хмарним розгортанням є важливою
- Вимоги продуктивності можуть бути задоволені правильним індексуванням та оптимізацією

---

## Рішення

**PostgreSQL 17** було обрано як основну базу даних для Системи моніторингу та відстеження нагород.

### Обраний підхід
- **База даних**: PostgreSQL 17 (остання стабільна версія)
- **Пул з'єднань**: HikariCP з Spring Boot
- **ORM**: Spring Data JPA з Hibernate
- **Міграція**: Flyway для версіонування схеми бази даних
- **Моніторинг**: pg_stat_statements та метрики рівня додатка

### Обґрунтування
- **Корпоративні функції**: Розширені функції як підтримка JSON, повнотекстовий пошук та віконні функції
- **ACID відповідність**: Сильна консистентність та підтримка транзакцій
- **Продуктивність**: Відмінна оптимізація запитів та можливості індексування
- **Підтримка JSON**: Нативна підтримка JSON/JSONB для гнучких метаданих документів
- **Повнотекстовий пошук**: Вбудовані можливості повнотекстового пошуку для контенту нагород
- **Open Source**: Відсутність ліцензійних витрат з корпоративними функціями
- **Спільнота**: Велика спільнота та обширна документація
- **Хмарна підтримка**: Відмінна підтримка у всіх основних хмарних провайдерів

---

## Наслідки

### Позитивні наслідки
- **Цілісність даних**: ACID відповідність забезпечує консистентність даних
- **Гнучкість**: Підтримка JSON дозволяє гнучку еволюцію схеми
- **Продуктивність**: Розширена оптимізація запитів та паралельна обробка
- **Повнотекстовий пошук**: Вбудований пошук зменшує потребу в зовнішніх пошукових системах
- **Розширюваність**: Користувацькі функції, тригери та розширення
- **Резервне копіювання та відновлення**: Надійне резервне копіювання та відновлення до моменту часу
- **Моніторинг**: Комплексні інструменти моніторингу продуктивності
- **Відповідність стандартам**: Відповідність стандарту SQL з розширеннями

### Негативні наслідки
- **Складність**: Розширені функції вимагають експертизи PostgreSQL
- **Використання пам'яті**: Вищі вимоги до пам'яті для оптимальної продуктивності
- **Конфігурація**: Потребує налаштування для оптимальної продуктивності
- **Крива навчання**: Розширені функції потребують вивчення та практики

### Нейтральні наслідки
- **Знання SQL**: Потребує сильних навичок SQL для оптимізації
- **Еволюція схеми**: Міграції баз даних потребують ретельного планування
- **Масштабування**: Вертикальне масштабування переважає над горизонтальним

---

## Розглянуті альтернативи

### Альтернатива 1: MySQL 8.0
- **Переваги**: Популярна open-source реляційна база даних
- **Недоліки**: Менше розширених функцій, слабша підтримка JSON, обмежений повнотекстовий пошук
- **Причина відхилення**: PostgreSQL пропонує кращі функції для складних додатків

### Альтернатива 2: Oracle Database
- **Переваги**: Відмінна продуктивність, комплексні функції, корпоративна підтримка
- **Недоліки**: Високі ліцензійні витрати, складне адміністрування, надмірно для портфоліо проекту
- **Причина відхилення**: Витрати та складність не виправдані для проекту соло розробника

### Альтернатива 3: MongoDB
- **Переваги**: Гнучка схема, добре для зберігання документів, просте масштабування
- **Недоліки**: Відсутність ACID транзакцій, слабші можливості запитів, менш знайомо для корпоративу
- **Причина відхилення**: Реляційна модель більше підходить для домену управління нагородами

---

## Примітки з реалізації

### Технічні вимоги
- **Версія PostgreSQL**: 17+ для останніх функцій та покращень продуктивності
- **Java драйвер**: PostgreSQL JDBC Driver 42.7+
- **Пул з'єднань**: HikariCP (за замовчуванням в Spring Boot)
- **Пам'ять**: Мінімум 4GB RAM для розробки, 8GB+ для продакшену

### Кроки реалізації
1. Встановити PostgreSQL 17 локально та в цільовому середовищі розгортання
2. Налаштувати Spring Boot з драйвером PostgreSQL та властивостями з'єднання
3. Налаштувати Flyway для управління міграціями бази даних
4. Створити початкову схему з правильними індексами та обмеженнями
5. Налаштувати пул з'єднань та моніторинг продуктивності
6. Реалізувати процедури резервного копіювання та відновлення

### Міграційні міркування
- **Версіонування схеми**: Використовувати Flyway для всіх змін схеми
- **Міграція даних**: Планування імпорту даних з існуючих систем
- **Налаштування продуктивності**: Оптимізація індексів та аналіз запитів
- **Стратегія резервного копіювання**: Регулярні резервні копії та тестування відновлення до моменту часу

---

## Відповідність та якість

### Наслідки для безпеки
- **Шифрування**: TLS для з'єднань, прозоре шифрування даних у спокої
- **Контроль доступу**: Рольовий контроль доступу з принципом найменших привілеїв
- **Журнал аудиту**: Комплексний журнал аудиту для відповідності GDPR
- **Маскування даних**: Підтримка анонімізації та псевдонімізації даних

### Вплив на продуктивність
- **Продуктивність читання**: Відмінна з правильним індексуванням та оптимізацією запитів
- **Продуктивність запису**: Хороша пропускна здатність транзакцій з відповідною конфігурацією
- **Масштабованість**: Вертикальне масштабування для обробки збільшеного навантаження
- **Кешування**: Інтеграція з Redis для часто використовуваних даних

### Супроводжуваність
- **Стандарти SQL**: Стандартний SQL з розширеннями PostgreSQL
- **Документація**: Відмінна документація та ресурси спільноти
- **Інструментарій**: Багата екосистема інструментів адміністрування та моніторингу
- **Експертиза**: Широко використовується в корпоративних середовищах

---

## Метрики успіху

### Ключові показники ефективності
- **Час відповіді запитів**: < 50ms для 95-го перцентиля запитів
- **Використання пулу з'єднань**: < 80% при нормальному навантаженні
- **Зростання розміру бази даних**: < 10GB на рік спочатку
- **Успішність резервного копіювання**: 100% успішних автоматизованих резервних копій

### Моніторинг та сповіщення
- **Моніторинг з'єднань**: Сповіщення про вичерпання пулу з'єднань
- **Моніторинг продуктивності**: Сповіщення про повільні запити (> 1 секунди)
- **Моніторинг сховища**: Сповіщення про використання дискового простору
- **Розклад огляду**: Щомісячний огляд продуктивності та оптимізація

---

## Пов'язані документи

- **Вимоги**: [Вимоги до даних](../../requirements/BUSINESS_REQUIREMENTS_ua.md#7-вимоги-до-даних)
- **Інші ADR**: [ADR-005 Кешування](./ADR-005-Caching-ua.md), [ADR-007 Пошукова система](./ADR-007-Search-Engine-ua.md)
- **Зовнішні ресурси**: 
  - [Документація PostgreSQL](https://www.postgresql.org/docs/)
  - [Довідник Spring Data JPA](https://spring.io/projects/spring-data-jpa)
- **Приклади реалізації**: Схема бази даних та конфігурація в `/src/main/resources`

---

## Історія версій

| **Дата** | **Автор** | **Зміни** | **Причина** |
|----------|------------|-------------|------------|
| 2025-08-20 | Стефан Костик | Початкова версія | Створення документа |

---

**Статус документа**: Затверджено  
**Дата наступного огляду**: 2025-11-20  
**Категорія ADR**: Технологія 