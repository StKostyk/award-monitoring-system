# ADR-020: Вибір хмарної платформи

**Статус**: Прийнято  
**Дата**: 2025-08-21  
**Автор**: Стефан Костик  
**Зацікавлені сторони**: Архітектор проекту, DevOps команда, Команда операційного відділу

---

## Контекст

Система моніторингу та відстеження нагород потребує хмарної платформи для продакшн розгортання, яка забезпечує корпоративні сервіси, масштабованість та надійність. Платформа повинна підтримувати Kubernetes оркестрацію, керовані бази даних та комплексний моніторинг, залишаючись при цьому економічно ефективною для портфоліо проекту.

### Передумови
- Вимоги продакшн розгортання для високої доступності та масштабованості
- Потреба в керованих сервісах для зменшення операційних накладних витрат
- Корпоративні функції безпеки та відповідності
- Глобальні вимоги доступності для українських та міжнародних користувачів
- Оптимізація витрат для економіки портфоліо проекту

### Припущення
- Хмарне розгортання забезпечує кращу масштабованість ніж on-premises
- Керовані сервіси зменшують операційну складність для одного розробника
- Мульти-хмарна стратегія може бути корисною для зменшення ризиків
- Україно-специфічні вимоги можуть віддавати перевагу певним хмарним провайдерам

---

## Рішення

**AWS (Основний) / Azure (Вторинний)** було обрано як хмарна платформа для Системи моніторингу та відстеження нагород.

### Обраний підхід
- **Основна хмара**: Amazon Web Services (AWS) для продакшн розгортання
- **Вторинна хмара**: Microsoft Azure як альтернативна/резервна опція
- **Керовані сервіси**: Використання cloud-native керованих сервісів де можливо
- **Мульти-регіон**: Розгортання в декількох регіонах для високої доступності

### Обґрунтування
- **Корпоративне прийняття**: AWS та Azure є провідними корпоративними хмарними платформами
- **Комплексні сервіси**: Повний набір керованих сервісів для всіх потреб додатка
- **Підтримка України**: Обидві платформи мають присутність та підтримку в Україні
- **Підтримка Kubernetes**: Відмінні керовані сервіси Kubernetes (EKS/AKS)
- **Цінність портфоліо**: Демонструє експертизу cloud-native архітектури

---

## Наслідки

### Позитивні наслідки
- **Масштабованість**: Практично необмежені можливості масштабування
- **Керовані сервіси**: Зменшені операційні накладні витрати з керованими базами даних та сервісами
- **Глобальна доступність**: Декілька регіонів для міжнародної доступності
- **Корпоративні функції**: Просунуті безпека, відповідність та можливості моніторингу
- **Інновації**: Доступ до найновіших cloud-native технологій та AI сервісів

### Негативні наслідки
- **Складність витрат**: Змінні витрати, які можуть ескалувати без належного управління
- **Залежінсть від постачальника**: Деякий ступінь платформо-специфічних залежностей
- **Крива навчання**: Потребує експертизи в сервісах хмарної платформи та найкращих практиках

### Нейтральні наслідки
- **Мульти-хмарна складність**: Управління двома хмарними платформами додає операційних накладних витрат
- **Вибір сервісу**: Багато опцій сервісів потребують ретельної оцінки та вибору

---

## Розглянуті альтернативи

### Альтернатива 1: Google Cloud Platform
- **Переваги**: Відмінна спадщина Kubernetes, конкурентне ціноутворення, інноваційні сервіси
- **Недоліки**: Менше корпоративного прийняття, обмежена присутність в Україні
- **Причина відхилення**: Нижче корпоративне прийняття та регіональна присутність

### Альтернатива 2: DigitalOcean
- **Переваги**: Просте ціноутворення, зручний для розробників, хороша продуктивність
- **Недоліки**: Обмежені корпоративні сервіси, менша глобальна присутність
- **Причина відхилення**: Недостатні корпоративні сервіси

### Альтернатива 3: On-Premises
- **Переваги**: Повний контроль, відсутність хмарних витрат, суверенітет даних
- **Недоліки**: Високі операційні накладні витрати, обмежена масштабованість, початкові витрати
- **Причина відхилення**: Не практично для портфоліо проекту одного розробника

---

## Примітки з реалізації

### Основні сервіси AWS
- **Обчислення**: Amazon EKS (Kubernetes) з EC2 worker nodes
- **База даних**: Amazon RDS для PostgreSQL з Multi-AZ розгортанням
- **Кешування**: Amazon ElastiCache для Redis
- **Сховище**: Amazon S3 для об'єктного сховища та резервних копій
- **CDN**: Amazon CloudFront для глобальної доставки контенту
- **Моніторинг**: Amazon CloudWatch та X-Ray для спостережливості
- **Безпека**: AWS IAM, Security Groups та WAF

### Вторинні сервіси Azure
- **Обчислення**: Azure Kubernetes Service (AKS)
- **База даних**: Azure Database для PostgreSQL
- **Кешування**: Azure Cache для Redis
- **Сховище**: Azure Blob Storage
- **CDN**: Azure CDN
- **Моніторинг**: Azure Monitor та Application Insights
- **Безпека**: Azure Active Directory та Network Security Groups

### Infrastructure as Code
```hcl
# Terraform конфігурація для AWS
provider "aws" {
  region = var.aws_region
}

resource "aws_eks_cluster" "award_system" {
  name     = "award-system-cluster"
  role_arn = aws_iam_role.cluster.arn
  version  = "1.28"

  vpc_config {
    subnet_ids = [
      aws_subnet.private_a.id,
      aws_subnet.private_b.id,
      aws_subnet.public_a.id,
      aws_subnet.public_b.id,
    ]
    endpoint_private_access = true
    endpoint_public_access  = true
  }

  depends_on = [
    aws_iam_role_policy_attachment.cluster_AmazonEKSClusterPolicy,
  ]
}

resource "aws_rds_instance" "award_system_db" {
  identifier     = "award-system-db"
  engine         = "postgres"
  engine_version = "16"
  instance_class = "db.t3.micro"
  
  allocated_storage     = 20
  max_allocated_storage = 100
  storage_encrypted     = true
  
  db_name  = "award_system"
  username = "award_user"
  password = random_password.db_password.result
  
  multi_az               = true
  backup_retention_period = 7
  backup_window          = "03:00-04:00"
  maintenance_window     = "sun:04:00-sun:05:00"
  
  skip_final_snapshot = false
  deletion_protection = true
  
  tags = {
    Name = "Award System Database"
    Environment = "production"
  }
}
```

### Стратегія оптимізації витрат
- **Зарезервовані Інстанси**: Використання зарезервованих інстансів для передбачуваних робочих навантажень
- **Spot інстанси**: Використання spot інстансів для некритичних робочих навантажень
- **Автомасштабування**: Реалізація автомасштабування для відповідності попиту
- **Оптимізація сховища**: Використання відповідних класів сховища та політик життєвого циклу
- **Теги ресурсів**: Комплексне тегування для розподілу витрат та оптимізації

---

## Відповідність та якість

### Наслідки для безпеки
- **Шифрування даних**: Шифрування в стані спокою та при передачі для всіх даних
- **Мережева безпека**: VPC, security groups та мережеві ACL
- **Управління ідентичністю**: IAM ролі та політики для доступу з найменшими привілеями
- **Відповідність**: Функції відповідності GDPR та контроль резидентності даних

### Вплив на продуктивність
- **Глобальний CDN**: CloudFront/Azure CDN для покращеної глобальної продуктивності
- **Multi-AZ розгортання**: Висока доступність через зони доступності
- **Автомасштабування**: Автоматичне масштабування на основі попиту
- **Керовані сервіси**: Оптимізована продуктивність з керованими сервісами баз даних

### Супроводжуваність
- **Infrastructure as Code**: Terraform для відтворюваної інфраструктури
- **Моніторинг**: Комплексний моніторинг та сповіщення
- **Стратегія резервного копіювання**: Автоматизовані резервні копії та відновлення після аварій
- **Документація**: Документація хмарної архітектури та runbooks

---

## Метрики успіху

### Ключові показники ефективності
- **Доступність**: 99.9% uptime SLA
- **Продуктивність**: < 200ms час відповіді глобально
- **Ефективність витрат**: < $500/місяць для продакшн середовища

### Моніторинг та сповіщення
- **Моніторинг інфраструктури**: CloudWatch/Azure Monitor дашборди
- **Продуктивність додатка**: APM інструменти для метрик додатка
- **Моніторинг витрат**: Бюджетні сповіщення та рекомендації оптимізації витрат
- **Моніторинг безпеки**: Події безпеки та моніторинг відповідності

---

## Пов'язані документи

- **Технічний стек**: [Вибір технологічного стеку](../TECH_STACK_ua.md)
- **Інші ADR**: [ADR-018 Orchestration](./ADR-018-Orchestration-ua.md), [ADR-019 CI/CD](./ADR-019-CICD-ua.md)
- **Зовнішні ресурси**: [AWS Documentation](https://docs.aws.amazon.com/), [Azure Documentation](https://docs.microsoft.com/en-us/azure/)

---

## Історія версій

| **Дата** | **Автор** | **Зміни** | **Причина** |
|----------|------------|-------------|------------|
| 2025-08-21 | Стефан Костик | Початкова версія | Створення документа |

---

**Статус документа**: Затверджено  
**Дата наступного огляду**: 2026-02-21  
**Категорія ADR**: Технологія 