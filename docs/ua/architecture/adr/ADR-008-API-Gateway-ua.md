# ADR-008: Вибір API Gateway

**Статус**: Прийнято  
**Дата**: 2025-08-20  
**Автор**: Стефан Костик  
**Зацікавлені сторони**: Архітектор проекту, Команда розробки, Команда операційного відділу

---

## Контекст

Система моніторингу та відстеження нагород потребує API Gateway для маршрутизації запитів, балансування навантаження, автентифікації та наскрізних проблем. Це підтримує майбутню архітектуру мікросервісів та забезпечує централізоване управління API.

### Передумови
- Централізована точка входу API для frontend та зовнішніх інтеграцій
- Наскрізні проблеми (автентифікація, обмеження швидкості, логування)
- Підтримка майбутньої міграції до мікросервісів
- Можливості балансування навантаження та відмовостійкості

---

## Рішення

**Spring Cloud Gateway** було обрано як API Gateway для Системи моніторингу та відстеження нагород.

### Обраний підхід
- **Gateway**: Spring Cloud Gateway 4.0+
- **Інтеграція**: Безшовна інтеграція екосистеми Spring Boot
- **Конфігурація**: YAML-базована конфігурація маршрутизації та фільтрів
- **Розгортання**: Вбудований у додаток Spring Boot спочатку

### Обґрунтування
- **Екосистема Spring**: Ідеальна інтеграція з Spring Boot та Spring Security
- **Реактивність**: Побудований на Spring WebFlux для високої продуктивності
- **Програмованість**: Java-базовані фільтри та предикати для складної маршрутизації
- **Cloud-Native**: Розроблений для хмарних та мікросервісних середовищ
- **Легковаговість**: Менший ресурсний слід порівняно з традиційними gateway

---

## Наслідки

### Позитивні наслідки
- **Консистентність екосистеми**: Той самий технологічний стек що й основний додаток
- **Продуктивність**: Реактивна архітектура з відмінною пропускною здатністю
- **Продуктивність розробки**: Знайомі Spring шаблони та конфігурація
- **Гнучкість**: Програмована конфігурація та користувацькі фільтри

### Негативні наслідки
- **Залежність від Spring**: Тісне зв'язування з екосистемою Spring
- **Крива навчання**: Концепції реактивного програмування WebFlux
- **Менше функцій**: Менше вбудованих функцій порівняно з спеціалізованими gateway

---

## Розглянуті альтернативи

### Альтернатива 1: Kong
- **Переваги**: Багатофункціональний, екосистема плагінів, UI управління
- **Недоліки**: Додаткова інфраструктура, інший технологічний стек
- **Причина відхилення**: Надмірно інженерний для проекту одного розробника

### Альтернатива 2: Zuul
- **Переваги**: Доведений Netflix, інтеграція Spring Cloud
- **Недоліки**: Застаріла технологія, режим обслуговування, блокуючий I/O
- **Причина відхилення**: Spring Cloud Gateway є сучасною заміною

---

## Примітки з реалізації

### Технічні вимоги
- **Версія Spring Cloud Gateway**: 4.0+ для сумісності з Spring Boot 3.x
- **Java**: Реактивне програмування з WebFlux
- **Пам'ять**: 512MB heap для функціональності gateway
- **Конфігурація**: YAML-базовані визначення маршрутів

### Конфігурація Gateway
```yaml
spring:
  cloud:
    gateway:
      routes:
        - id: award-service
          uri: lb://award-service
          predicates:
            - Path=/api/v1/awards/**
          filters:
            - AddRequestHeader=X-Request-Source, gateway
            - name: RateLimiter
              args:
                rate-limiter: "#{@redisRateLimiter}"
        - id: user-service
          uri: lb://user-service
          predicates:
            - Path=/api/v1/users/**
```

### Наскрізні проблеми
- **Автентифікація**: Фільтр валідації JWT токенів
- **Обмеження швидкості**: Redis-базоване обмеження швидкості
- **Логування**: Фільтр логування запитів/відповідей
- **CORS**: Конфігурація cross-origin resource sharing

---

## Метрики успіху

- **Затримка запитів**: < 10ms накладних витрат gateway
- **Пропускна здатність**: > 10,000 запитів/секунду
- **Доступність**: 99.9% uptime для функціональності gateway

---

## Пов'язані документи

- **Технічний стек**: [Вибір технологічного стеку](../TECH_STACK_ua.md)
- **Шаблони інтеграції**: [Корпоративні шаблони інтеграції](../INTEGRATION_PATTERNS_ua.md)
- **Зовнішні ресурси**: [Документація Spring Cloud Gateway](https://spring.io/projects/spring-cloud-gateway)

---

## Історія версій

| **Дата** | **Автор** | **Зміни** | **Причина** |
|----------|------------|-------------|------------|
| 2025-08-20 | Стефан Костик | Початкова версія | Створення документа |

---

**Статус документа**: Затверджено  
**Дата наступного огляду**: 2026-02-20  
**Категорія ADR**: Технологія 