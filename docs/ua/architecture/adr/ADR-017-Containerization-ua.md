# ADR-017: Вибір платформи контейнеризації

**Статус**: Прийнято  
**Дата**: 2025-08-21  
**Автор**: Стефан Костик  
**Зацікавлені сторони**: Архітектор проекту, DevOps команда, Команда розробки

---

## Контекст

Система моніторингу та відстеження нагород потребує рішення контейнеризації для забезпечення консистентних середовищ розробки та розгортання на різних платформах. Рішення повинно підтримувати локальну розробку, тестування та сценарії продакшн розгортання.

### Передумови
- Потреба в консистентному середовищі розробки на різних машинах
- Складний стек додатків з множинними сервісами (Spring Boot, PostgreSQL, Redis, Kafka, Elasticsearch)
- Середовище соло розробника, що потребує простого налаштування та управління
- Вимоги продакшн розгортання для масштабованості та надійності

### Припущення
- Контейнеризація є важливою для сучасного розгортання додатків
- Docker є промисловим стандартом для контейнеризації
- Локальне середовище розробки повинно максимально відповідати продакшену
- Оркестрація контейнерів буде потрібна для продакшн розгортання

---

## Рішення

**Docker + Docker Compose** було обрано як платформа контейнеризації для Системи моніторингу та відстеження нагород.

### Обраний підхід
- **Контейнеризація**: Docker для контейнеризації додатків та сервісів
- **Локальна оркестрація**: Docker Compose для локального середовища розробки
- **Базові образи**: Офіційні OpenJDK та Node.js образи для контейнерів додатків
- **Багатоетапні збірки**: Оптимізовані Docker збірки для продакшн розгортань

### Обґрунтування
- **Промисловий стандарт**: Docker є фактичним стандартом для контейнеризації
- **Консистентність середовища розробки**: Ідентичні середовища на машинах розробки
- **Проста оркестрація**: Docker Compose забезпечує легке локальне управління мульти-сервісами
- **Підтримка екосистеми**: Відмінний інструментарій та підтримка спільноти
- **Готовність до продакшену**: Безшовний перехід від розробки до продакшн середовищ

---

## Наслідки

### Позитивні наслідки
- **Консистентність середовища**: Ідентична поведінка в розробці, тестуванні та продакшені
- **Легке налаштування**: Нові розробники можуть одразу почати працювати з docker-compose up
- **Ізоляція**: Сервіси працюють в ізольованих контейнерах, запобігаючи конфліктам
- **Масштабованість**: Основа для горизонтального масштабування в продакшені
- **Дебаггінг**: Консистентне середовище зменшує проблеми "працює на моїй машині"

### Негативні наслідки
- **Накладні витрати ресурсів**: Контейнери споживають додаткову пам'ять та CPU
- **Крива навчання**: Розробники повинні розуміти Docker концепції та команди
- **Складність**: Додатковий рівень складності в робочому процесі розробки

### Нейтральні наслідки
- **Вимоги до сховища**: Docker образи та контейнери потребують дискового простору
- **Конфігурація мережі**: Мережа контейнерів потребує розуміння та конфігурації

---

## Розглянуті альтернативи

### Альтернатива 1: Podman
- **Переваги**: "Бездемонна" архітектура, rootless контейнери, відповідність OCI
- **Недоліки**: Менша екосистема, менша підтримка інструментів, крива навчання для команди
- **Причина відхилення**: Перевага екосистеми та інструментарію Docker

### Альтернатива 2: Нативне встановлення
- **Переваги**: Відсутність накладних витрат контейнеризації, прямий доступ до сервісів
- **Недоліки**: Непослідовність середовищ, складне налаштування, конфлікти залежностей
- **Причина відхилення**: Непослідовні середовища та складність налаштування

### Альтернатива 3: Віртуальні машини
- **Переваги**: Сильна ізоляція, знайома технологія
- **Недоліки**: Важке використання ресурсів, повільний запуск, складне управління
- **Причина відхилення**: Важковагове рішення з поганим досвідом розробника

---

## Примітки з реалізації

### Технічні вимоги
- **Docker Engine**: Остання стабільна версія (24.0+)
- **Docker Compose**: v2.0+ для останніх функцій та продуктивності
- **Базові образи**: Офіційні OpenJDK 21, Node 18, PostgreSQL 17, Redis 7 образи
- **Реєстр**: Docker Hub для базових образів, приватний реєстр для образів додатків

### Application Dockerfile
```dockerfile
# Багатоетапна збірка для Spring Boot додатка
FROM openjdk:21-jdk-slim as builder

WORKDIR /app
COPY mvnw .
COPY .mvn .mvn
COPY pom.xml .
RUN ./mvnw dependency:go-offline

COPY src ./src
RUN ./mvnw clean package -DskipTests

FROM openjdk:21-jre-slim

RUN addgroup --system spring && adduser --system spring --ingroup spring
USER spring:spring

COPY --from=builder /app/target/*.jar app.jar

EXPOSE 8080
ENTRYPOINT ["java", "-jar", "/app.jar"]
```

### Конфігурація Docker Compose
```yaml
version: '3.8'

services:
  app:
    build: .
    ports:
      - "8080:8080"
    environment:
      - SPRING_PROFILES_ACTIVE=docker
      - SPRING_DATASOURCE_URL=jdbc:postgresql://db:5432/award_system
    depends_on:
      - db
      - redis
      - kafka
    networks:
      - award-network

  db:
    image: postgres:17
    environment:
      POSTGRES_DB: award_system
      POSTGRES_USER: award_user
      POSTGRES_PASSWORD: award_pass
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5432:5432"
    networks:
      - award-network

  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"
    networks:
      - award-network

  elasticsearch:
    image: elasticsearch:8.11.0
    environment:
      - discovery.type=single-node
      - xpack.security.enabled=false
    ports:
      - "9200:9200"
    volumes:
      - es_data:/usr/share/elasticsearch/data
    networks:
      - award-network

volumes:
  postgres_data:
  es_data:

networks:
  award-network:
    driver: bridge
```

### Робочий процес розробки
```bash
# Запуск всіх сервісів
docker-compose up -d

# Перегляд логів
docker-compose logs -f app

# Перезбірка та перезапуск додатка
docker-compose build app
docker-compose restart app

# Чистий зупин
docker-compose down
```

---

## Відповідність та якість

### Наслідки для безпеки
- **Не-root користувачі**: Контейнери додатків працюють як не-root користувачі
- **Ізоляція мережі**: Сервіси спілкуються через ізольовані Docker мережі
- **Управління секретами**: Змінні середовища для чутливої конфігурації
- **Безпека базових образів**: Регулярні оновлення базових образів для патчів безпеки

### Вплив на продуктивність
- **Використання ресурсів**: Контейнери додають мінімальні накладні витрати порівняно з VM
- **Час запуску**: Швидкий запуск контейнерів порівняно з традиційним розгортанням
- **Масштабування**: Можливості горизонтального масштабування для продакшн розгортання

### Супроводжуваність
- **Інфраструктура як код**: Docker Compose файли версіонуються
- **Відтворювані збірки**: Консистентні збірки в різних середовищах
- **Легкі оновлення**: Оновлення сервісів через оновлення образів контейнерів
- **Стратегія резервного копіювання**: Персистентність даних на основі томів для баз даних

---

## Метрики успіху

### Ключові показники ефективності
- **Час налаштування середовища**: < 5 хвилин від клонування до працюючого додатка
- **Час запуску контейнера**: < 30 секунд для контейнера додатка
- **Ефективність ресурсів**: < 20% накладних витрат порівняно з нативним розгортанням

### Моніторинг та сповіщення
- **Здоров'я контейнерів**: Health checks для всіх контейнерів додатків
- **Моніторинг ресурсів**: Моніторинг використання CPU та пам'яті
- **Агрегація логів**: Централізоване логування з усіх контейнерів

---

## Пов'язані документи

- **Технічний стек**: [Вибір технологічного стеку](../TECH_STACK_ua.md)
- **Інші ADR**: [ADR-018 Orchestration](./ADR-018-Orchestration-ua.md)
- **Зовнішні ресурси**: [Документація Docker](https://docs.docker.com/)

---

## Історія версій

| **Дата** | **Автор** | **Зміни** | **Причина** |
|----------|------------|-------------|------------|
| 2025-08-21 | Стефан Костик | Початкова версія | Створення документа |

---

**Статус документа**: Затверджено  
**Дата наступного огляду**: 2026-02-21  
**Категорія ADR**: Технологія 