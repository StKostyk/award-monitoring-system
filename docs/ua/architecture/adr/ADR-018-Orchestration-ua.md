# ADR-018: Вибір платформи оркестрації контейнерів

**Статус**: Прийнято  
**Дата**: 2025-08-21  
**Автор**: Стефан Костик  
**Зацікавлені сторони**: Архітектор проекту, DevOps команда, Команда операційного відділу

---

## Контекст

Система моніторингу та відстеження нагород потребує платформи оркестрації контейнерів для продакшн розгортання, яка забезпечує масштабованість, високу доступність та можливості операційного управління. Платформа повинна підтримувати контейнеризований стек додатків та забезпечувати корпоративні функції.

### Передумови
- Вимоги продакшн розгортання для високої доступності та масштабованості
- Потреба в автоматизованому розгортанні, масштабуванні та управлінні контейнеризованих додатків
- Вимоги балансування навантаження та service discovery
- Можливості моніторингу здоров'я та self-healing
- Корпоративні функції безпеки та відповідності

### Припущення
- Оркестрація контейнерів є важливою для продакшн-рівня розгортання
- Kubernetes є промисловим стандартом для оркестрації контейнерів
- Cloud-native функції будуть корисними для майбутньої масштабованості
- Навчальні інвестиції в Kubernetes забезпечать довгострокову цінність портфоліо

---

## Рішення

**Kubernetes** було обрано як платформа оркестрації контейнерів для Системи моніторингу та відстеження нагород.

### Обраний підхід
- **Платформа оркестрації**: Kubernetes (остання стабільна версія)
- **Розгортання**: Керований сервіс Kubernetes (EKS/AKS) для продакшену
- **Локальна розробка**: Kind або Minikube для локального тестування Kubernetes
- **Управління пакетами**: Helm для розгортання та конфігурації додатків

### Обґрунтування
- **Масштабованість продакшену**: Можливості горизонтального масштабування та балансування навантаження
- **Корпоративне прийняття**: Промисловий стандарт для оркестрації контейнерів
- **Cloud-Native**: Нативна підтримка у всіх основних хмарних провайдерів
- **Self-Healing**: Автоматичний перезапуск та заміна невдалих контейнерів
- **Цінність портфоліо**: Демонструє сучасну DevOps та cloud-native експертизу

---

## Наслідки

### Позитивні наслідки
- **Масштабованість**: Автоматичне горизонтальне та вертикальне масштабування на основі попиту
- **Висока доступність**: Розгортання з декількома репліками з health checks
- **Rolling оновлення**: Розгортання без простою з можливістю rollback
- **Service Discovery**: Вбудований service discovery та балансування навантаження
- **Корпоративні функції**: RBAC, мережеві політики та квоти ресурсів

### Негативні наслідки
- **Складність**: Крута крива навчання та операційні накладні витрати
- **Вимоги до ресурсів**: Додаткові ресурси інфраструктури для рівня управління
- **Операційні накладні витрати**: Потребує експертизи Kubernetes для управління

### Нейтральні наслідки
- **Залежність від постачальника**: Cloud-специфічні функції Kubernetes можуть створити деяку прив'язку
- **Вартість**: Додаткові витрати на керовані сервіси Kubernetes

---

## Розглянуті альтернативи

### Альтернатива 1: Docker Swarm
- **Переваги**: Простіший ніж Kubernetes, хороша інтеграція Docker
- **Недоліки**: Обмежена екосистема, менше корпоративного прийняття, менше функцій
- **Причина відхилення**: Обмежена масштабованість та обмежені корпоративні функції

### Альтернатива 2: Nomad
- **Переваги**: Простіші операції, підтримка мульти-workload
- **Недоліки**: Менша екосистема, менша підтримка хмарних провайдерів
- **Причина відхилення**: Обмежена інтеграція cloud-native екосистеми

### Альтернатива 3: Serverless (Lambda/Functions)
- **Переваги**: Відсутність управління інфраструктурою, pay-per-use
- **Недоліки**: Залежність від постачальника, обмежений контроль, проблеми cold start
- **Причина відхилення**: Не підходить для персистентних сервісів як бази даних

---

## Примітки з реалізації

### Технічні вимоги
- **Версія Kubernetes**: 1.28+ для останніх функцій та безпеки
- **Версія Helm**: 3.0+ для управління пакетами
- **Ingress Controller**: NGINX Ingress Controller для зовнішнього доступу
- **Моніторинг**: Prometheus та Grafana для моніторингу кластера

### Конфігурація Kubernetes Deployment
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: award-system-api
  labels:
    app: award-system-api
spec:
  replicas: 3
  selector:
    matchLabels:
      app: award-system-api
  template:
    metadata:
      labels:
        app: award-system-api
    spec:
      containers:
      - name: api
        image: award-system/api:latest
        ports:
        - containerPort: 8080
        env:
        - name: SPRING_PROFILES_ACTIVE
          value: "kubernetes"
        - name: SPRING_DATASOURCE_URL
          valueFrom:
            secretKeyRef:
              name: database-secret
              key: url
        resources:
          requests:
            memory: "512Mi"
            cpu: "250m"
          limits:
            memory: "1Gi"
            cpu: "500m"
        livenessProbe:
          httpGet:
            path: /actuator/health
            port: 8080
          initialDelaySeconds: 30
          periodSeconds: 10
        readinessProbe:
          httpGet:
            path: /actuator/health/readiness
            port: 8080
          initialDelaySeconds: 5
          periodSeconds: 5
```

### Конфігурація Service
```yaml
apiVersion: v1
kind: Service
metadata:
  name: award-system-api-service
spec:
  selector:
    app: award-system-api
  ports:
  - protocol: TCP
    port: 80
    targetPort: 8080
  type: ClusterIP
```

### Структура Helm Chart
```
helm/
├── Chart.yaml
├── values.yaml
├── values-prod.yaml
├── values-staging.yaml
└── templates/
    ├── deployment.yaml
    ├── service.yaml
    ├── ingress.yaml
    ├── configmap.yaml
    ├── secret.yaml
    └── hpa.yaml
```

### Horizontal Pod Autoscaler
```yaml
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: award-system-api-hpa
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: award-system-api
  minReplicas: 2
  maxReplicas: 10
  metrics:
  - type: Resource
    resource:
      name: cpu
      target:
        type: Utilization
        averageUtilization: 70
  - type: Resource
    resource:
      name: memory
      target:
        type: Utilization
        averageUtilization: 80
```

---

## Відповідність та якість

### Наслідки для безпеки
- **RBAC**: Рольовий контроль доступу для ресурсів кластера
- **Мережеві політики**: Мікросегментація для комунікації контейнерів
- **Pod Security Standards**: Політики безпеки для runtime контейнерів
- **Управління секретами**: Kubernetes secrets для чутливої конфігурації

### Вплив на продуктивність
- **Ефективність ресурсів**: Ефективне використання ресурсів з лімітами ресурсів
- **Балансування навантаження**: Вбудоване балансування навантаження між репліками pod
- **Автомасштабування**: Автоматичне масштабування на основі метрик CPU/пам'яті

### Супроводжуваність
- **Інфраструктура як код**: Всі Kubernetes маніфести версіонуються
- **GitOps**: Автоматизація розгортання через Git-базовані робочі процеси
- **Моніторинг**: Комплексний моніторинг з Prometheus та Grafana
- **Логування**: Централізоване логування з Fluentd або подібним

---

## Метрики успіху

### Ключові показники ефективності
- **Доступність додатка**: 99.9% uptime SLA
- **Успішність розгортання**: 95% успішних розгортань
- **Ефективність автомасштабування**: < 30 секунд для масштабування під навантаженням

### Моніторинг та сповіщення
- **Здоров'я кластера**: Моніторинг здоров'я node та pod
- **Використання ресурсів**: Відстеження використання CPU, пам'яті та сховища
- **Метрики додатка**: Моніторинг специфічних для додатка метрик

---

## Пов'язані документи

- **Технічний стек**: [Вибір технологічного стеку](../TECH_STACK_ua.md)
- **Інші ADR**: [ADR-017 Containerization](./ADR-017-Containerization-ua.md), [ADR-020 Cloud Platform](./ADR-020-Cloud-Platform-ua.md)
- **Зовнішні ресурси**: [Документація Kubernetes](https://kubernetes.io/docs/)

---

## Історія версій

| **Дата** | **Автор** | **Зміни** | **Причина** |
|----------|------------|-------------|------------|
| 2025-08-21 | Стефан Костик | Початкова версія | Створення документа |

---

**Статус документа**: Затверджено  
**Дата наступного огляду**: 2026-02-21  
**Категорія ADR**: Технологія 