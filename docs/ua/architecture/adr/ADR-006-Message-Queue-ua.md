# ADR-006: Вибір черги повідомлень

**Статус**: Прийнято  
**Дата**: 2025-08-20  
**Автор**: Стефан Костик  
**Зацікавлені сторони**: Архітектор проекту, Команда розробки, Команда операційного відділу

---

## Контекст

Система моніторингу та відстеження нагород потребує черги повідомлень для архітектури на основі подій, асинхронної обробки та роз'єднання системних компонентів. Це підтримує журнали аудиту, сповіщення та майбутню міграцію до мікросервісів.

### Передумови
- Архітектура на основі подій для подій життєвого циклу нагород
- Асинхронна обробка для парсингу документів та сповіщень
- Вимоги журналу аудиту GDPR через event sourcing
- Потреби комунікації майбутніх мікросервісів

---

## Рішення

**Apache Kafka** було обрано як рішення черги повідомлень для Системи моніторингу та відстеження нагород.

### Обраний підхід
- **Message Broker**: Apache Kafka 3.0+
- **Інтеграція**: Spring Kafka з автоконфігурацією Spring Boot
- **Топіки**: Топіки специфічні для подій (award-events, user-events, document-events)
- **Розгортання**: Один broker для розробки, кластер для продакшену

### Обґрунтування
- **Event Sourcing**: Ідеально підходить для ведення журналів аудиту та історії подій
- **Масштабованість**: Горизонтальне масштабування та можливості високої пропускної здатності
- **Довговічність**: Персистентне зберігання подій з налаштовуваним періодом зберігання
- **Інтеграція Spring**: Відмінна інтеграція Spring Kafka
- **Корпоративне прийняття**: Промисловий стандарт для систем на основі подій

---

## Наслідки

### Позитивні наслідки
- **Роз'єднання**: Слабке зв'язування між системними компонентами
- **Журнал аудиту**: Повна історія подій для відповідності GDPR
- **Масштабованість**: Асинхронна обробка покращує чутливість системи
- **Готовність до майбутнього**: Готово для міграції архітектури мікросервісів

### Негативні наслідки
- **Складність**: Додатковий компонент інфраструктури для управління
- **Крива навчання**: Концепції та найкращі практики Kafka
- **Використання ресурсів**: Вимоги до пам'яті та диска для зберігання повідомлень

---

## Розглянуті альтернативи

### Альтернатива 1: RabbitMQ
- **Переваги**: Простіше налаштування, добре для шаблонів запит-відповідь, UI управління
- **Недоліки**: Нижча пропускна здатність, менше підходить для event sourcing
- **Причина відхилення**: Kafka краще підходить для архітектури на основі подій

### Альтернатива 2: Amazon SQS
- **Переваги**: Керований сервіс, відсутність накладних витрат на інфраструктуру
- **Недоліки**: Прив'язка до постачальника, вищі витрати, обмежені функції event sourcing
- **Причина відхилення**: Перевага open-source рішення для портфоліо

---

## Примітки з реалізації

### Технічні вимоги
- **Версія Kafka**: 3.0+ для останніх функцій та продуктивності
- **Інтеграція Spring**: Spring Kafka 3.0+
- **Сховище**: Мінімум 10GB для зберігання подій
- **Пам'ять**: 2GB heap для Kafka broker

### Схема подій
```json
{
  "eventType": "award.created",
  "eventId": "uuid",
  "timestamp": "2025-01-16T10:30:00Z",
  "source": "award-service",
  "subject": "award-123",
  "data": { /* корисне навантаження події */ }
}
```

### Конфігурація топіків
- **award-events**: Події життєвого циклу нагород (створено, затверджено, опубліковано)
- **user-events**: Події управління користувачами (зареєстровано, оновлено)
- **document-events**: Події обробки документів (завантажено, проаналізовано)

---

## Метрики успіху

- **Пропускна здатність повідомлень**: > 1000 повідомлень/секунду
- **Наскрізна затримка**: < 100ms для обробки подій
- **Затримка споживача**: < 5 секунд при нормальному навантаженні

---

## Пов'язані документи

- **Технічний стек**: [Вибір технологічного стеку](../TECH_STACK_ua.md)
- **Шаблони інтеграції**: [Корпоративні шаблони інтеграції](../INTEGRATION_PATTERNS_ua.md)
- **Зовнішні ресурси**: [Документація Apache Kafka](https://kafka.apache.org/documentation/)

---

## Історія версій

| **Дата** | **Автор** | **Зміни** | **Причина** |
|----------|------------|-------------|------------|
| 2025-08-20 | Стефан Костик | Початкова версія | Створення документа |

---

**Статус документа**: Затверджено  
**Дата наступного огляду**: 2026-02-20  
**Категорія ADR**: Технологія 