# ADR-009: Вибір security framework

**Статус**: Прийнято  
**Дата**: 2025-08-20  
**Автор**: Стефан Костик  
**Зацікавлені сторони**: Архітектор проекту, Команда безпеки, Команда розробки

---

## Контекст

Система моніторингу та відстеження нагород потребує комплексних функцій безпеки, включаючи автентифікацію, авторизацію, відповідність GDPR та захист від поширених загроз безпеки. Система обробляє чутливі дані користувачів та нагород.

### Передумови
- Багаторольова автентифікація (працівники, адміністратори, супер-адміністратори)
- Інтеграція OAuth2 для інституційного SSO
- Відповідність GDPR з вимогами захисту даних
- Рольовий контроль доступу (RBAC) для гранульованих дозволів

---

## Рішення

**Spring Security 6+** було обрано як фреймворк захисту для Системи моніторингу та відстеження нагород.

### Обраний підхід
- **Security Framework**: Spring Security 6+ з Spring Boot 3.x
- **Автентифікація**: OAuth2 + JWT токени для stateless автентифікації
- **Авторизація**: Рольовий контроль доступу (RBAC) з безпекою на рівні методів
- **Управління сесіями**: Stateless з Redis для зберігання токенів

### Обґрунтування
- **Екосистема Spring**: Безшовна інтеграція з Spring Boot та іншими компонентами
- **Підтримка OAuth2**: Вбудовані можливості OAuth2 клієнта та ресурсного сервера
- **Відповідність GDPR**: Функції для захисту даних та контролю приватності
- **Корпоративні функції**: Комплексні функції безпеки out-of-the-box
- **Спільнота**: Велика спільнота та обширна документація

---

## Наслідки

### Позитивні наслідки
- **Комплексна безпека**: Захист від вразливостей OWASP Top 10
- **Відповідність стандартам**: OAuth2, JWT та корпоративні стандарти безпеки
- **Інтеграція**: Безшовна з Spring Boot, Spring Cloud Gateway
- **Гнучкість**: Програмна та annotation-базована конфігурація

### Негативні наслідки
- **Складність**: Крива навчання для розширених конфігурацій безпеки
- **Продуктивність**: Додаткові накладні витрати для перевірок безпеки
- **Конфігурація**: Складне налаштування для розширених випадків використання

---

## Розглянуті альтернативи

### Альтернатива 1: Apache Shiro
- **Переваги**: Простіший API, хороша документація, гнучка архітектура
- **Недоліки**: Менша екосистема, менша інтеграція Spring
- **Причина відхилення**: Spring Security краще вписується в екосистему

### Альтернатива 2: Користувацька реалізація безпеки
- **Переваги**: Повний контроль, мінімальні залежності
- **Недоліки**: Ризики безпеки, накладні витрати на обслуговування, винаходження велосипеда
- **Причина відхилення**: Безпека занадто критична для користувацької реалізації

---

## Примітки з реалізації

### Технічні вимоги
- **Версія Spring Security**: 6.0+ для сумісності з Spring Boot 3.x
- **JWT бібліотека**: Spring Security OAuth2 José
- **Кодування паролів**: BCrypt зі стійкістю 12
- **Зберігання токенів**: Redis для чорного списку токенів та управління сесіями

### Конфігурація безпеки
```java
@Configuration
@EnableWebSecurity
@EnableMethodSecurity(prePostEnabled = true)
public class SecurityConfig {
    
    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        return http
            .oauth2ResourceServer(oauth2 -> oauth2.jwt(withDefaults()))
            .authorizeHttpRequests(authz -> authz
                .requestMatchers("/api/v1/public/**").permitAll()
                .requestMatchers("/api/v1/admin/**").hasRole("ADMIN")
                .anyRequest().authenticated()
            )
            .sessionManagement(session -> session
                .sessionCreationPolicy(SessionCreationPolicy.STATELESS))
            .build();
    }
}
```

### Реалізація RBAC
- **Ролі**: EMPLOYEE, FACULTY_SECRETARY, DEAN, RECTOR_SECRETARY, RECTOR, SUPER_ADMIN
- **Дозволи**: award:read, award:create, award:approve, user:manage
- **Безпека методів**: Анотації `@PreAuthorize` для детального контролю

---

## Метрики успіху

- **Вразливості безпеки**: 0 критичних проблем безпеки
- **Час автентифікації**: < 100ms для валідації токенів
- **Покриття авторизації**: 100% захищених endpoints

---

## Пов'язані документи

- **Технічний стек**: [Вибір технологічного стеку](../TECH_STACK_ua.md)
- **Відповідність**: [Security Framework](../../compliance/SECURITY_FRAMEWORK_ua.md)
- **Зовнішні ресурси**: [Документація Spring Security](https://spring.io/projects/spring-security)

---

## Історія версій

| **Дата** | **Автор** | **Зміни** | **Причина** |
|----------|------------|-------------|------------|
| 2025-08-20 | Стефан Костик | Початкова версія | Створення документа |

---

**Статус документа**: Затверджено  
**Дата наступного огляду**: 2026-02-20  
**Категорія ADR**: Технологія 