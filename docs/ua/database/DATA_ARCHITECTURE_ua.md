# Архітектура Даних
## Система Моніторингу та Відстеження Нагород

> **Результат Фази 9**: Архітектура Даних та Проєктування Бази Даних  
> **Версія Документа**: 1.0  
> **Останнє Оновлення**: Грудень 2025  
> **Автор**: Стефан Костик  
> **Класифікація**: Внутрішній

---

## Резюме

Цей документ визначає комплексну архітектуру даних для Системи Моніторингу та Відстеження Нагород, що охоплює принципи моделювання даних, управління якістю, відстеження походження даних та управління майстер-даними. Архітектура забезпечує управління даними корпоративного рівня з дотриманням вимог GDPR та підтримкою цілей прозорості системи.

### Ключові Принципи Архітектури

| **Принцип** | **Опис** | **Реалізація** |
|-------------|----------|----------------|
| **Єдине Джерело Істини** | Кожен елемент даних має одне авторитетне джерело | Сервіси майстер-даних, нормалізована схема |
| **Якість Даних за Проєктом** | Валідація вбудована на всіх рівнях | Bean Validation, обмеження бази даних, правила застосунку |
| **Приватність за Замовчуванням** | Персональні дані захищені від створення | Класифікація GDPR, шифрування, контроль доступу |
| **Аудитовність** | Всі зміни відстежуються та простежуються | Тригери аудиту, event sourcing, незмінні журнали |
| **Domain-Driven Design** | Моделі даних відображають бізнес-домени | Обмежені контексти, агрегатні корені |

---

## 1. Підхід до Моделювання Даних

### 1.1 Принципи Domain-Driven Design

Модель даних слідує принципам Domain-Driven Design (DDD) з чітко визначеними обмеженими контекстами:

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        ОБМЕЖЕНІ КОНТЕКСТИ                                    │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌──────────────────┐    ┌──────────────────┐    ┌──────────────────┐      │
│  │   КОНТЕКСТ       │    │   КОНТЕКСТ       │    │   КОНТЕКСТ       │      │
│  │   ІДЕНТИЧНОСТІ   │    │   НАГОРОД        │    │   РОБОЧОГО       │      │
│  │                  │    │                  │    │   ПРОЦЕСУ        │      │
│  ├──────────────────┤    ├──────────────────┤    ├──────────────────┤      │
│  │ • User           │    │ • Award          │    │ • AwardRequest   │      │
│  │ • UserRole       │◄───┤ • AwardCategory  │◄───┤ • ReviewDecision │      │
│  │ • Organization   │    │ • Document       │    │                  │      │
│  │                  │    │                  │    │                  │      │
│  └──────────────────┘    └──────────────────┘    └──────────────────┘      │
│           │                       │                       │                 │
│           ▼                       ▼                       ▼                 │
│  ┌──────────────────┐    ┌──────────────────┐                              │
│  │   КОНТЕКСТ       │    │   КОНТЕКСТ       │                              │
│  │   ВІДПОВІДНОСТІ  │    │   СПОВІЩЕНЬ      │                              │
│  ├──────────────────┤    ├──────────────────┤                              │
│  │ • AuditLog       │    │ • Notification   │                              │
│  │ • ConsentRecord  │    │ • NotifPreference│                              │
│  └──────────────────┘    └──────────────────┘                              │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 1.2 Ідентифікація Агрегатних Коренів

Кожен обмежений контекст має ідентифіковані агрегатні корені що служать межами узгодженості:

| **Обмежений Контекст** | **Агрегатний Корінь** | **Належні Сутності** | **Обсяг Узгодженості** |
|------------------------|-----------------------|----------------------|------------------------|
| Ідентичність | `User` | UserRole | Користувач з усіма ролями |
| Ідентичність | `Organization` | (самодостатній) | Ієрархія організації |
| Нагорода | `Award` | Document | Нагорода з документами |
| Робочий Процес | `AwardRequest` | ReviewDecision | Запит з рішеннями |
| Відповідність | `AuditLog` | (самодостатній) | Окремий запис журналу |
| Відповідність | `ConsentRecord` | (самодостатній) | Окремий запис згоди |
| Сповіщення | `Notification` | (самодостатній) | Окреме сповіщення |

### 1.3 Логічна Модель Даних

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                       ЛОГІЧНА МОДЕЛЬ ДАНИХ                                   │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│                        ┌─────────────────┐                                  │
│                        │  Organization   │                                  │
│                        │─────────────────│                                  │
│                        │ • Університет   │                                  │
│                        │ • Факультет     │◄────────────┐                    │
│                        │ • Кафедра       │             │ (ієрархія)         │
│                        └────────┬────────┘             │                    │
│                                 │                      │                    │
│                                 │ належить до          │                    │
│                                 ▼                      │                    │
│         ┌───────────────────────────────────────────────────────┐          │
│         │                      User                              │          │
│         │───────────────────────────────────────────────────────│          │
│         │ • email_address (ідентичність)                         │          │
│         │ • first_name, last_name (ПД)                           │          │
│         │ • account_status (життєвий цикл)                       │          │
│         └───────┬────────────────────┬─────────────────┬────────┘          │
│                 │                    │                 │                    │
│        має ролі │           володіє  │         має     │                    │
│                 ▼                    ▼                 ▼                    │
│  ┌──────────────────┐    ┌──────────────────┐  ┌───────────────┐          │
│  │    UserRole      │    │     Award        │  │ ConsentRecord │          │
│  │──────────────────│    │──────────────────│  │───────────────│          │
│  │ • EMPLOYEE       │    │ • title          │  │ • consent_type│          │
│  │ • FACULTY_SEC    │    │ • description    │  │ • is_granted  │          │
│  │ • DEAN           │    │ • award_date     │  │ • version     │          │
│  │ • RECTOR_SEC     │    │ • status         │  └───────────────┘          │
│  │ • RECTOR         │    │ • impact_score   │                              │
│  │ • SYSTEM_ADMIN   │    └────────┬─────────┘                              │
│  │ • GDPR_OFFICER   │             │                                        │
│  └──────────────────┘             │ має                                    │
│                                   ▼                                        │
│          ┌────────────────────────┴────────────────────────┐               │
│          │                                                  │               │
│          ▼                                                  ▼               │
│  ┌──────────────────┐                           ┌──────────────────┐       │
│  │    Document      │                           │   AwardRequest   │       │
│  │──────────────────│                           │──────────────────│       │
│  │ • file_metadata  │                           │ • status         │       │
│  │ • storage_ref    │                           │ • current_level  │       │
│  │ • ai_metadata    │                           │ • deadline       │       │
│  │ • confidence     │                           └────────┬─────────┘       │
│  └──────────────────┘                                    │                 │
│                                                          │ має             │
│                                                          ▼                 │
│                                              ┌──────────────────┐          │
│                                              │  ReviewDecision  │          │
│                                              │──────────────────│          │
│                                              │ • decision       │          │
│                                              │ • level          │          │
│                                              │ • comments       │          │
│                                              └──────────────────┘          │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 1.4 Відображення Фізичної Моделі

| **Логічна Сутність** | **Фізична Таблиця(и)** | **Стратегія Відображення** |
|---------------------|------------------------|---------------------------|
| User | `users`, `user_roles` | З'єднання один-до-багатьох |
| Organization | `organizations` | Самопосилальна ієрархія |
| Award | `awards`, `documents` | Композиція один-до-багатьох |
| AwardCategory | `award_categories` | Самопосилальна ієрархія |
| AwardRequest | `award_requests`, `review_decisions` | Композиція один-до-багатьох |
| AuditLog | `audit_logs` | Партиціонований за датою |
| ConsentRecord | `consent_records` | Проста сутність |
| Notification | `notifications`, `notification_preferences` | Окремі сутності |

---

## 2. Управління Якістю Даних

### 2.1 Виміри Якості Даних

| **Вимір** | **Визначення** | **Вимірювання** | **Ціль** |
|-----------|----------------|-----------------|----------|
| **Точність** | Дані правильно представляють реальний світ | Рівень верифікації | >99% |
| **Повнота** | Обов'язкові поля заповнені | Перевірка на null | 100% обов'язкових |
| **Узгодженість** | Однакові дані по всій системі | Крос-референсна валідація | 100% |
| **Своєчасність** | Дані актуальні та доступні | Метрики застарілості | <24г для нагород |
| **Унікальність** | Немає дублікатів записів | Виявлення дублікатів | 0 дублікатів |
| **Валідність** | Дані відповідають правилам | Рівень проходження валідації | 100% |

### 2.2 Архітектура Шарів Валідації

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                     АРХІТЕКТУРА ШАРІВ ВАЛІДАЦІЇ                              │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌──────────────────────────────────────────────────────────────────────┐   │
│  │                    ШАР ПРЕЗЕНТАЦІЇ                                   │   │
│  │  ┌─────────────────────────────────────────────────────────────────┐ │   │
│  │  │  Валідація Angular Reactive Forms                               │ │   │
│  │  │  • Індикатори обов'язкових полів                                │ │   │
│  │  │  • Валідація формату (email, дата)                              │ │   │
│  │  │  • Обмеження довжини                                            │ │   │
│  │  │  • Зворотний зв'язок в реальному часі                           │ │   │
│  │  └─────────────────────────────────────────────────────────────────┘ │   │
│  └──────────────────────────────────────────────────────────────────────┘   │
│                                     │                                        │
│                                     ▼                                        │
│  ┌──────────────────────────────────────────────────────────────────────┐   │
│  │                     ШАР API (Controller)                             │   │
│  │  ┌─────────────────────────────────────────────────────────────────┐ │   │
│  │  │  Bean Validation (JSR-380)                                       │ │   │
│  │  │  • @NotNull, @NotBlank, @Size                                   │ │   │
│  │  │  • @Email, @Pattern                                             │ │   │
│  │  │  • @Valid для вкладених об'єктів                                │ │   │
│  │  │  • Кастомні валідатори (@ValidAwardDate)                        │ │   │
│  │  └─────────────────────────────────────────────────────────────────┘ │   │
│  └──────────────────────────────────────────────────────────────────────┘   │
│                                     │                                        │
│                                     ▼                                        │
│  ┌──────────────────────────────────────────────────────────────────────┐   │
│  │                    ШАР СЕРВІСІВ (Бізнес-логіка)                       │   │
│  │  ┌─────────────────────────────────────────────────────────────────┐ │   │
│  │  │  Валідація Бізнес-правил                                        │ │   │
│  │  │  • Валідація переходів станів                                   │ │   │
│  │  │  • Крос-сутнісна узгодженість                                   │ │   │
│  │  │  • Перевірки авторизації                                        │ │   │
│  │  │  • Забезпечення правил робочого процесу                         │ │   │
│  │  └─────────────────────────────────────────────────────────────────┘ │   │
│  └──────────────────────────────────────────────────────────────────────┘   │
│                                     │                                        │
│                                     ▼                                        │
│  ┌──────────────────────────────────────────────────────────────────────┐   │
│  │                    ШАР РЕПОЗИТОРІЮ (JPA/Hibernate)                   │   │
│  │  ┌─────────────────────────────────────────────────────────────────┐ │   │
│  │  │  JPA Валідація                                                  │ │   │
│  │  │  • @Column(nullable = false)                                    │ │   │
│  │  │  • @Column(length = 255)                                        │ │   │
│  │  │  • Callback-и pre-persist/pre-update                            │ │   │
│  │  └─────────────────────────────────────────────────────────────────┘ │   │
│  └──────────────────────────────────────────────────────────────────────┘   │
│                                     │                                        │
│                                     ▼                                        │
│  ┌──────────────────────────────────────────────────────────────────────┐   │
│  │                    ШАР БАЗИ ДАНИХ (PostgreSQL)                       │   │
│  │  ┌─────────────────────────────────────────────────────────────────┐ │   │
│  │  │  Обмеження Бази Даних (Остання Лінія Захисту)                    │ │   │
│  │  │  • NOT NULL обмеження                                           │ │   │
│  │  │  • CHECK обмеження (enum значення, діапазони)                   │ │   │
│  │  │  • UNIQUE обмеження                                             │ │   │
│  │  │  • FOREIGN KEY обмеження                                        │ │   │
│  │  │  • Валідація на основі тригерів                                 │ │   │
│  │  └─────────────────────────────────────────────────────────────────┘ │   │
│  └──────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 2.3 Правила Валідації Сутностей

#### 2.3.1 Валідація Сутності User

```java
// Приклад Bean Validation (для документації - фактична реалізація під час розробки)
public class UserDTO {
    
    @NotBlank(message = "Email обов'язковий")
    @Email(message = "Невірний формат email")
    @Size(max = 255, message = "Email не повинен перевищувати 255 символів")
    private String emailAddress;
    
    @NotBlank(message = "Ім'я обов'язкове")
    @Size(min = 1, max = 100, message = "Ім'я повинно бути 1-100 символів")
    @Pattern(regexp = "^[\\p{L}\\s'-]+$", message = "Ім'я містить недопустимі символи")
    private String firstName;
    
    @NotBlank(message = "Прізвище обов'язкове")
    @Size(min = 1, max = 100, message = "Прізвище повинно бути 1-100 символів")
    @Pattern(regexp = "^[\\p{L}\\s'-]+$", message = "Прізвище містить недопустимі символи")
    private String lastName;
    
    @NotNull(message = "Організація обов'язкова")
    private Long organizationId;
}
```

#### 2.3.2 Валідація Сутності Award

```java
// Правила валідації нагороди (для документації)
public class AwardDTO {
    
    @NotBlank(message = "Назва обов'язкова")
    @Size(min = 3, max = 500, message = "Назва повинна бути 3-500 символів")
    private String title;
    
    @Size(max = 10000, message = "Опис не повинен перевищувати 10000 символів")
    private String description;
    
    @NotBlank(message = "Організація що нагороджує обов'язкова")
    @Size(max = 255, message = "Організація що нагороджує не повинна перевищувати 255 символів")
    private String awardingOrganization;
    
    @NotNull(message = "Дата нагородження обов'язкова")
    @PastOrPresent(message = "Дата нагородження не може бути в майбутньому")
    private LocalDate awardDate;
    
    @NotNull(message = "Категорія обов'язкова")
    private Long categoryId;
}
```

#### 2.3.3 Правила Валідації Документів

| **Поле** | **Правило** | **Повідомлення Помилки** |
|----------|-------------|-------------------------|
| `file_name` | Обов'язковий, макс 255 символів | "Ім'я файлу обов'язкове" |
| `file_type` | Повинен бути PDF, JPG, PNG, або WEBP | "Непідтримуваний тип файлу" |
| `file_size` | Макс 10МБ (10,485,760 байт) | "Розмір файлу перевищує ліміт 10МБ" |
| `mime_type` | Повинен відповідати file_type | "Невідповідність MIME типу" |
| `checksum` | Формат SHA-256 (64 hex символи) | "Невірний формат контрольної суми" |

### 2.4 Правила Очищення Даних

| **Тип Даних** | **Правило Очищення** | **Реалізація** |
|---------------|---------------------|----------------|
| Email | Нижній регістр, обрізати пробіли | `email.toLowerCase().trim()` |
| Імена | Обрізати пробіли, нормалізувати Unicode | `Normalizer.normalize(name, NFD)` |
| Телефон | Видалити нецифрові, форматувати | `phone.replaceAll("[^0-9+]", "")` |
| URLs | Валідувати формат, нормалізувати | Валідація URL + кодування |
| Дати | Парсити з урахуванням локалі | `DateTimeFormatter` з локаллю |
| Текст | Видалити контрольні символи | Заміна regex |

---

## 3. Походження Даних

### 3.1 Огляд Потоку Даних

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        ПОХОДЖЕННЯ ДАНИХ: ЖИТТЄВИЙ ЦИКЛ НАГОРОДИ              │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ЗОВНІШНІ ДЖЕРЕЛА                        ОБРОБКА СИСТЕМИ                    │
│  ────────────────                        ───────────────                    │
│                                                                              │
│  ┌────────────────┐                                                         │
│  │ Введення       │───────────────────┐                                     │
│  │ Користувача    │                   │                                     │
│  │ (Веб Форма)    │                   │                                     │
│  └────────────────┘                   │                                     │
│                                       ▼                                     │
│  ┌────────────────┐         ┌─────────────────┐        ┌────────────────┐  │
│  │ Сканований     │────────►│ Сервіс Нагород  │───────►│ awards         │  │
│  │ Сертифікат     │         │ (Валідація)     │        │ (PostgreSQL)   │  │
│  └────────────────┘         └────────┬────────┘        └────────────────┘  │
│                                      │                                      │
│                                      │ запускає                             │
│                                      ▼                                      │
│                            ┌─────────────────┐        ┌────────────────┐   │
│                            │ AI Парсер       │───────►│ documents      │   │
│                            │ (Метадані)      │        │ (parsed_meta)  │   │
│                            └────────┬────────┘        └────────────────┘   │
│                                     │                                       │
│                                     │ створює                               │
│                                     ▼                                       │
│                            ┌─────────────────┐        ┌────────────────┐   │
│                            │ Движок          │───────►│ award_requests │   │
│                            │ Робочого Процесу│        │ review_decisions│  │
│                            │ (Машина Станів) │        └────────────────┘   │
│                            └────────┬────────┘                              │
│                                     │                                       │
│                                     │ всі операції                          │
│                                     ▼                                       │
│                            ┌─────────────────┐        ┌────────────────┐   │
│                            │ Сервіс Аудиту   │───────►│ audit_logs     │   │
│                            │ (Захоплення     │        │ (Незмінний)    │   │
│                            │  Подій)         │        └────────────────┘   │
│                            └─────────────────┘                              │
│                                                                              │
│  ВИХІДНІ ПУНКТИ                                                             │
│  ─────────────────                                                          │
│                                                                              │
│  ┌────────────────┐         ┌─────────────────┐        ┌────────────────┐  │
│  │ Публічний      │◄────────│ API Gateway     │◄───────│ awards (API)   │  │
│  │ Портал         │         │ (Трансформація) │        │ (лише approved)│  │
│  │ (Тільки читання)│        └─────────────────┘        └────────────────┘  │
│  └────────────────┘                                                         │
│                                                                              │
│  ┌────────────────┐         ┌─────────────────┐        ┌────────────────┐  │
│  │ Аналітика      │◄────────│ ETL Pipeline    │◄───────│ Сховище Даних  │  │
│  │ Dashboard      │         │ (Агрегація)     │        │ (Репліка)      │  │
│  └────────────────┘         └─────────────────┘        └────────────────┘  │
│                                                                              │
│  ┌────────────────┐         ┌─────────────────┐        ┌────────────────┐  │
│  │ GDPR Експорт   │◄────────│ Сервіс Експорту │◄───────│ Дані Користувача│  │
│  │ (JSON/CSV)     │         │ (Анонімізація)  │        │ (Всі сутності) │  │
│  └────────────────┘         └─────────────────┘        └────────────────┘  │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Відображення Джерело-Ціль

| **Джерело** | **Трансформація** | **Ціль** | **Частота** |
|-------------|-------------------|----------|-------------|
| Веб Форма (Нагорода) | Валідація, збагачення | таблиця `awards` | При поданні |
| Завантаження Файлу | AI парсинг, зберігання | таблиця `documents` + S3 | При завантаженні |
| Подання Нагороди | Ініціалізація робочого процесу | таблиця `award_requests` | При поданні |
| Дія Рецензента | Перехід стану | таблиця `review_decisions` | При дії |
| Будь-яка Операція БД | Захоплення події | таблиця `audit_logs` | В реальному часі |
| Згода Користувача | Запис стану згоди | таблиця `consent_records` | При зміні |
| `awards` (approved) | Фільтрація, трансформація | Відповідь Public API | За запитом |
| Всі дані користувача | Агрегація, анонімізація | Файл експорту GDPR | За запитом |

### 3.3 Правила Трансформації Даних

| **Сутність** | **Поле** | **Трансформація** | **Призначення** |
|--------------|----------|-------------------|-----------------|
| Award | `title` | Обрізати, HTML escape | Безпека, узгодженість |
| Award | `impact_score` | Обчислити з категорії + орг | Бізнес-логіка |
| Document | `parsed_metadata` | AI витяг з зображення | Автоматизація |
| Document | `confidence_score` | Вихід AI моделі | Індикатор якості |
| User | `password_hash` | BCrypt(password, 12) | Безпека |
| Audit | `old_values` | JSON серіалізація стану до | Відстеження змін |
| Audit | `new_values` | JSON серіалізація стану після | Відстеження змін |
| Export | Персональні дані | Анонімізація (опційно) | Відповідність GDPR |

### 3.4 Реалізація Відстеження Походження Даних

```java
// Відстеження походження даних через патерн event sourcing (документація)
@Service
public class DataLineageService {
    
    public void trackDataOrigin(DataLineageEvent event) {
        LineageRecord record = LineageRecord.builder()
            .entityType(event.getEntityType())
            .entityId(event.getEntityId())
            .sourceSystem(event.getSourceSystem())
            .sourceType(event.getSourceType())  // USER_INPUT, AI_PARSED, SYSTEM_GENERATED
            .transformations(event.getTransformations())
            .createdAt(Instant.now())
            .correlationId(event.getCorrelationId())
            .build();
        
        lineageRepository.save(record);
    }
}

// Метадані походження зберігаються в audit_logs.new_values JSONB
// {
//   "lineage": {
//     "source": "user_input",
//     "source_field": "award_title",
//     "transformations": ["trim", "html_escape"],
//     "validation_passed": true
//   }
// }
```

---

## 4. Управління Майстер-Даними

### 4.1 Сутності Майстер-Даних

Майстер-дані представляють основні довідкові сутності які поділяються по всій системі та рідко змінюються:

| **Майстер-Дані** | **Сутність** | **Власник** | **Частота Оновлення** |
|------------------|--------------|-------------|----------------------|
| Організації | `organizations` | Системний Адмін | Рідко (структурні зміни) |
| Категорії Нагород | `award_categories` | Системний Адмін | Іноді (зміни політики) |
| Визначення Ролей | (enum значення) | Системний Адмін | Контроль версій |
| Коди Статусів | (enum значення) | Системний Адмін | Контроль версій |
| Типи Згоди | (enum значення) | Офіцер GDPR | Контроль політики |

### 4.2 Стратегія Довідкових Даних

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                     УПРАВЛІННЯ ДОВІДКОВИМИ ДАНИМИ                            │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌──────────────────────────────────────────────────────────────────────┐   │
│  │                    СТАТИЧНІ ДОВІДКОВІ ДАНІ                           │   │
│  │  (Визначені в коді, управляються через міграції схеми)               │   │
│  │                                                                        │   │
│  │  • UserStatus: PENDING, ACTIVE, INACTIVE, SUSPENDED, RETIRED, MEMORIAL │  │
│  │  • AwardStatus: DRAFT, PENDING, APPROVED, REJECTED, ARCHIVED          │   │
│  │  • RequestStatus: SUBMITTED, IN_REVIEW, ESCALATED, APPROVED, ...      │   │
│  │  • ApprovalLevel: FACULTY_SECRETARY, DEAN, RECTOR_SECRETARY, RECTOR   │   │
│  │  • RoleType: EMPLOYEE, FACULTY_SECRETARY, DEAN, ...                   │   │
│  │  • ConsentType: DATA_PROCESSING, PUBLIC_VISIBILITY, ...               │   │
│  │  • RecognitionLevel: DEPARTMENT, FACULTY, UNIVERSITY, NATIONAL, ...   │   │
│  │                                                                        │   │
│  │  Реалізація: Java Enums + CHECK обмеження бази даних                   │   │
│  └──────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
│  ┌──────────────────────────────────────────────────────────────────────┐   │
│  │                    ДИНАМІЧНІ ДОВІДКОВІ ДАНІ                          │   │
│  │  (Управляються через адмін UI, зберігаються в базі даних)             │   │
│  │                                                                        │   │
│  │  • Організації: Структура університету (факультети, кафедри)          │   │
│  │  • Категорії Нагород: Таксономія класифікації                         │   │
│  │                                                                        │   │
│  │  Реалізація: Таблиці бази даних з адмін CRUD операціями                │   │
│  └──────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
│  ┌──────────────────────────────────────────────────────────────────────┐   │
│  │                    УПРАВЛІННЯ SEED ДАНИМИ                            │   │
│  │  (Початкові дані завантажуються через міграції Flyway)                │   │
│  │                                                                        │   │
│  │  Файли Міграцій:                                                      │   │
│  │  • R__seed_organizations.sql (Повторювана)                            │   │
│  │  • R__seed_award_categories.sql (Повторювана)                         │   │
│  │  • V002__seed_initial_admin.sql (Версіонована, одноразова)            │   │
│  │                                                                        │   │
│  │  Повторювані міграції (R__) перезапускаються коли змінюється checksum │   │
│  └──────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 4.3 Управління Ієрархією Організацій

```sql
-- Приклад seed даних ієрархії організацій (тільки документація)
-- Фактичне заповнення через повторювані міграції Flyway під час розробки

-- Університет (Корінь)
INSERT INTO organizations (name, name_uk, org_type, parent_org_id, depth, hierarchy_path)
VALUES ('Example University', 'Приклад Університет', 'UNIVERSITY', NULL, 0, 'university');

-- Факультети
INSERT INTO organizations (name, name_uk, org_type, parent_org_id, depth, hierarchy_path)
VALUES ('Faculty of Engineering', 'Факультет інженерії', 'FACULTY', 1, 1, 'university.engineering');

-- Кафедри
INSERT INTO organizations (name, name_uk, org_type, parent_org_id, depth, hierarchy_path)
VALUES ('Computer Science Department', 'Кафедра інформатики', 'DEPARTMENT', 2, 2, 'university.engineering.cs');
```

### 4.4 Таксономія Категорій Нагород

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                      ТАКСОНОМІЯ КАТЕГОРІЙ НАГОРОД                            │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  РІВЕНЬ ВИЗНАННЯ: МІЖНАРОДНИЙ                                               │
│  ├── Міжнародна Дослідницька Нагорода                                       │
│  ├── Найкраща Стаття Міжнародної Конференції                                │
│  └── Міжнародний Грант/Стипендія                                            │
│                                                                              │
│  РІВЕНЬ ВИЗНАННЯ: НАЦІОНАЛЬНИЙ                                              │
│  ├── Національна Наукова Премія                                             │
│  ├── Державна Премія                                                        │
│  ├── Визнання Міністерства                                                  │
│  └── Національний Грант                                                     │
│                                                                              │
│  РІВЕНЬ ВИЗНАННЯ: УНІВЕРСИТЕТ                                               │
│  ├── Нагорода за Досконалість Університету                                  │
│  ├── Премія Найкращого Викладача                                            │
│  ├── Дослідницьке Досягнення                                                │
│  └── Нагорода за Інновації                                                  │
│                                                                              │
│  РІВЕНЬ ВИЗНАННЯ: ФАКУЛЬТЕТ                                                 │
│  ├── Факультетська Педагогічна Премія                                       │
│  ├── Факультетське Дослідницьке Визнання                                    │
│  └── Премія за Служіння Факультету                                          │
│                                                                              │
│  РІВЕНЬ ВИЗНАННЯ: КАФЕДРА                                                   │
│  ├── Подяка Кафедри                                                         │
│  ├── Нагорода за Командну Співпрацю                                         │
│  └── Визнання Наставництва                                                  │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 4.5 Правила Управління Майстер-Даними

| **Правило** | **Опис** | **Забезпечення** |
|-------------|----------|------------------|
| Єдине Володіння | Кожна майстер-сутність має одну роль-власника | Авторизація Адмін UI |
| Контроль Змін | Всі зміни потребують затвердження | Журнал аудиту + сповіщення |
| Історія Версій | Ведеться повна історія | Тригери аудиту |
| Цілісність Посилань | Не можна видалити посилані дані | FK обмеження + soft delete |
| Двомовна Підтримка | Всі назви на EN та UK | Обов'язкові поля |
| Прапор Активності | Деактивувати замість видалення | Колонка `is_active` |

---

## 5. Патерни Інтеграції Даних

### 5.1 Внутрішня Інтеграція

| **Джерело** | **Ціль** | **Патерн** | **Тригер** |
|-------------|----------|------------|------------|
| Сервіс Нагород | Сервіс Робочого Процесу | Синхронний API | Подання нагороди |
| Сервіс Робочого Процесу | Сервіс Сповіщень | Async Event (Kafka) | Зміна стану |
| Сервіс Документів | AI Сервіс | Async Event (Kafka) | Завантаження документа |
| Всі Сервіси | Сервіс Аудиту | Async Event (Kafka) | Будь-яка операція |
| Всі Сервіси | Кеш (Redis) | Cache-aside | Операції читання |

### 5.2 Точки Зовнішньої Інтеграції

| **Зовнішня Система** | **Тип Інтеграції** | **Дані що Обмінюються** | **Безпека** |
|---------------------|-------------------|------------------------|-------------|
| Object Storage (S3) | REST API | Файли документів | IAM + шифрування |
| AI/ML Сервіс | REST API | Зображення, метадані | API key + TLS |
| Email Сервіс | SMTP/API | Сповіщення | TLS + auth |
| SSO Провайдер | OAuth2/OIDC | Токени автентифікації | OAuth2 flow |
| Аналітична Платформа | ETL/API | Агреговані метрики | API key + VPN |

### 5.3 Стратегія Синхронізації Даних

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                    СТРАТЕГІЯ СИНХРОНІЗАЦІЇ ДАНИХ                             │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ПЕРВИННА БАЗА ДАНИХ (PostgreSQL)                                           │
│  ─────────────────────────────────                                           │
│  Джерело істини для всіх транзакційних даних                                │
│                                                                              │
│        │                                                                     │
│        │ WAL (Write-Ahead Log)                                              │
│        ▼                                                                     │
│  ┌──────────────┐        ┌──────────────┐        ┌──────────────┐          │
│  │ Репліка      │        │ Change Data  │        │ Event Bus    │          │
│  │ для Читання  │        │ Capture      │        │ (Kafka)      │          │
│  │ (PostgreSQL) │        │              │        │              │          │
│  └──────────────┘        └──────────────┘        └──────────────┘          │
│        │                        │                        │                  │
│        │                        │                        │                  │
│        ▼                        ▼                        ▼                  │
│  ┌──────────────┐        ┌──────────────┐        ┌──────────────┐          │
│  │ Запити       │        │ Пошуковий    │        │ Споживачі    │          │
│  │ Звітності    │        │ Індекс       │        │ Сповіщень    │          │
│  │              │        │ (Elastic)    │        │              │          │
│  └──────────────┘        └──────────────┘        └──────────────┘          │
│                                                                              │
│  ШАР КЕШУ (Redis)                                                           │
│  ──────────────────                                                         │
│  • Дані сесій                                                               │
│  • Налаштування користувачів                                                │
│  • Довідкові дані (організації, категорії)                                  │
│  • Лічильники rate limiting                                                 │
│                                                                              │
│  Інвалідація Кешу: Event-driven через Kafka topics                          │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 6. Класифікація Безпеки Даних

### 6.1 Класифікація Даних за GDPR

| **Класифікація** | **Типи Даних** | **Рівень Захисту** | **Зберігання** |
|------------------|----------------|-------------------|----------------|
| **Публічний** | Затверджені нагороди, публічні профілі | Стандартний | Постійно |
| **Внутрішній** | Структура організації, категорії | Шифрування at rest | 7 років |
| **Конфіденційний** | ПД користувачів, контактна інформація, згоди | Шифрування + контроль доступу | Контроль користувача |
| **Обмежений** | Документи, облікові дані, журнали аудиту | E2E шифрування + аудит | За політикою |

### 6.2 Реалізація Захисту Даних

| **Контроль** | **Реалізація** | **Обсяг Даних** |
|--------------|----------------|-----------------|
| Шифрування At Rest | PostgreSQL TDE + S3 SSE | Всі збережені дані |
| Шифрування In Transit | TLS 1.3 | Весь мережевий трафік |
| Шифрування на Рівні Полів | Application-level (Jasypt) | Паролі, чутливі ПД |
| Токенізація | Ключі зберігання документів | Посилання на файли |
| Анонімізація | GDPR експорт за запитом | Персональні дані |
| Псевдонімізація | ID користувачів в журналах | Дані аудиту |
| Логування Доступу | Весь доступ до даних логується | Конфіденційний + Обмежений |

---

## 7. Метрики Архітектури Даних

### 7.1 Ключові Показники Ефективності

| **Метрика** | **Ціль** | **Вимірювання** | **Частота** |
|-------------|----------|-----------------|-------------|
| Оцінка Якості Даних | >95% | Рівень проходження валідації | Щоденно |
| Узгодженість Схеми | 100% | Рівень успіху міграцій | При деплойменті |
| Продуктивність Запитів | <200мс P99 | APM моніторинг | Безперервно |
| Свіжість Даних | <1 хвилина | Затримка реплікації | Безперервно |
| Ефективність Зберігання | <80% ємності | Моніторинг диску | Щоденно |
| Рівень Успіху Бекапів | 100% | Завершення backup job | Щоденно |

### 7.2 Прогнози Росту Даних

| **Сутність** | **Початковий Розмір** | **Місячний Ріст** | **Прогноз на Рік 1** |
|--------------|----------------------|-------------------|----------------------|
| Користувачі | 1,000 | 50 | 1,600 |
| Нагороди | 5,000 | 500 | 11,000 |
| Документи | 10,000 | 1,000 | 22,000 |
| Запити | 5,000 | 500 | 11,000 |
| Журнали Аудиту | 100,000 | 50,000 | 700,000 |
| Сповіщення | 50,000 | 25,000 | 350,000 |

---

## 8. Дорожня Карта Реалізації

### 8.1 Завдання Архітектури Даних Фази Розробки

| **Завдання** | **Фаза** | **Пріоритет** | **Залежності** |
|--------------|----------|---------------|----------------|
| Налаштування Flyway та початкові міграції | MVP | P0 | - |
| Реалізація валідації сутностей | MVP | P0 | Схема |
| Тригери журналювання аудиту | MVP | P0 | Схема |
| Заповнення майстер-даних | MVP | P1 | Схема |
| Шар кешування Redis | MVP | P1 | Основні сервіси |
| Публікація подій Kafka | Post-MVP | P2 | Сервіс робочого процесу |
| Інтеграція пошукового індексу | Post-MVP | P2 | Сервіс нагород |
| Pipeline даних аналітики | Post-MVP | P3 | Основні функції |

### 8.2 Критерії Успіху

- [ ] Всі сутності мають комплексну валідацію на всіх рівнях
- [ ] Журналювання аудиту захоплює 100% модифікацій даних
- [ ] Заповнення майстер-даних є повторюваним та ідемпотентним
- [ ] Походження даних простежується для всіх даних нагород
- [ ] Класифікація даних GDPR забезпечена через контроль доступу
- [ ] Цілі продуктивності досягнуті для типових патернів запитів

---

*Версія Документа: 1.0*  
*Класифікація: Внутрішній*  
*Фаза: 9 - Архітектура Даних та Проєктування Бази Даних*  
*Автор: Стефан Костик*
