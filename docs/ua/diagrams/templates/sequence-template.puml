@startuml Sequence_Template_UA
' =============================================================================
' Шаблон Діаграми Послідовності
' Система Моніторингу та Відстеження Нагород
' =============================================================================
' Використання: Скопіюйте цей шаблон та модифікуйте для вашого випадку
' Найкраще для: Взаємодії користувачів, API потоки, системні інтеграції
' =============================================================================

!theme plain
skinparam sequenceMessageAlign center

title [Назва Функції] - Діаграма Послідовності

' =============================================================================
' УЧАСНИКИ
' =============================================================================
' Актори (користувачі/зовнішні системи)
actor "Роль Користувача" as user

' Frontend
participant "Веб-Додаток" as webapp

' Backend Сервіси
participant "API Шлюз" as gateway
participant "Сервіс Аутентифікації" as auth
participant "Основний API" as core
participant "Інший Сервіс" as other

' Сховища Даних
database "PostgreSQL" as db
queue "Kafka" as kafka
database "Redis" as cache

' Зовнішні Системи
participant "Зовнішній\nСервіс" as external

' =============================================================================
' ПОТІК ПОСЛІДОВНОСТІ
' =============================================================================

== Назва Секції (напр., Аутентифікація) ==

user -> webapp: Опис дії користувача
activate webapp

webapp -> gateway: HTTP Метод /ендпоінт
activate gateway

gateway -> auth: Валідувати токен
activate auth
auth --> gateway: Токен валідний
deactivate auth

gateway -> core: Обробити запит
activate core

' =============================================================================
' ОПЕРАЦІЇ БАЗИ ДАНИХ
' =============================================================================
core -> db: SQL Запит/Операція
activate db
db --> core: Результат
deactivate db

' =============================================================================
' ОПЕРАЦІЇ КЕШУ
' =============================================================================
core -> cache: Пошук у кеші
activate cache
alt Кеш влучення
    cache --> core: Закешовані дані
else Кеш промах
    cache --> core: null
    core -> db: Отримати з БД
    db --> core: Дані
    core -> cache: Зберегти в кеш
end
deactivate cache

' =============================================================================
' АСИНХРОННІ ОПЕРАЦІЇ (Kafka)
' =============================================================================
core -> kafka: publish(тип.події)
note right: Асинхронне сповіщення

' =============================================================================
' УМОВНА ЛОГІКА
' =============================================================================
alt Умова успіху
    core --> gateway: 200 OK + відповідь
    gateway --> webapp: Успішна відповідь
    webapp --> user: Показати успіх
else Умова помилки
    core --> gateway: 4xx/5xx Помилка
    gateway --> webapp: Відповідь помилки
    webapp --> user: Показати помилку
end

deactivate core
deactivate gateway
deactivate webapp

' =============================================================================
' АСИНХРОННИЙ СПОЖИВАЧ (окремий потік)
' =============================================================================
== Асинхронна Обробка ==

kafka -> other: consume(тип.події)
activate other
other -> external: Виклик зовнішнього API
activate external
external --> other: Відповідь
deactivate external
other -> db: Зберегти результат
deactivate other

' =============================================================================
' ПРИМІТКИ
' =============================================================================
note over user, webapp
    Примітки взаємодії користувача
end note

note right of core
    Примітки бізнес-логіки:
    • Правила валідації
    • Кроки обробки
end note

@enduml


