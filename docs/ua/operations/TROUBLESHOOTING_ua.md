# Посібник з усунення несправностей
## Система моніторингу та відстеження нагород

> **Артефакт Фази 17**: Документація та управління знаннями  
> **Версія документа**: 1.0  
> **Останнє оновлення**: Січень 2026  
> **Автор**: Стефан Костик  

---

## Швидка довідка

| Симптом | Ймовірна причина | Швидке рішення | Розділ |
|---------|------------------|----------------|--------|
| 401 Unauthorized | Токен прострочений | Повторний вхід або оновлення токена | [Проблеми авторизації](#проблеми-авторизації) |
| 500 Internal Error | Помилка застосунку | Перевірте логи, перезапустіть pod | [Серверні помилки](#серверні-помилки) |
| Повільні відповіді | Проблема БД/ресурсів | Перевірте метрики, масштабуйте | [Проблеми продуктивності](#проблеми-продуктивності) |
| Connection refused | Сервіс недоступний | Перевірте статус pod | [Проблеми підключення](#проблеми-підключення) |
| Помилка завантаження | Файл занадто великий | Перевірте ліміти розміру файлів | [Проблеми завантаження](#проблеми-завантаження-файлів) |

---

## Проблеми авторизації

### Проблема: "401 Unauthorized" при API-запитах

**Причини:**
- Прострочений токен доступу
- Невірний формат токена
- Токен не включено у запит

**Рішення:**

```bash
# 1. Перевірте термін дії токена
echo $TOKEN | cut -d. -f2 | base64 -d | jq .exp

# 2. Оновіть токен
curl -X POST https://api.award-system.edu.ua/auth/refresh \
  -H "Content-Type: application/json" \
  -d '{"refreshToken": "ваш-refresh-токен"}'

# 3. Повторно увійдіть, якщо refresh токен також прострочений
curl -X POST https://api.award-system.edu.ua/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email": "user@example.com", "password": "password"}'
```

### Проблема: "403 Forbidden" - Недостатньо прав

**Причини:**
- Роль користувача не має необхідного дозволу
- Спроба доступу до ресурсу іншого користувача
- Невідповідність організаційної області

**Рішення:**
1. Перевірте роль користувача у профілі (`GET /users/me`)
2. Перевірте, чи ресурс належить організації користувача
3. Зверніться до адміністратора для підвищення ролі

---

## Серверні помилки

### Проблема: "500 Internal Server Error"

**Діагностика:**

```bash
# Перевірте логи застосунку
kubectl logs -l app=award-backend -n award-system --tail=100

# Шукайте винятки
kubectl logs -l app=award-backend | grep -i "exception\|error" | tail -20

# Перевірте останні події
kubectl get events -n award-system --sort-by='.lastTimestamp' | tail -10
```

**Типові причини та рішення:**

| Патерн у логах | Причина | Рішення |
|----------------|---------|---------|
| `NullPointerException` | Відсутні дані | Перевірте payload запиту |
| `DataIntegrityViolation` | Обмеження БД | Виправте дані або обмеження |
| `OutOfMemoryError` | Вичерпання пам'яті | Збільште ліміт пам'яті |
| `ConnectionRefused` | Залежний сервіс недоступний | Перевірте статус сервісу |

---

## Проблеми продуктивності

### Проблема: Повільний час відповіді API

**Діагностика:**

```bash
# Перевірте час відповіді
curl -w "Time: %{time_total}s\n" -o /dev/null -s \
  https://api.award-system.edu.ua/awards

# Перевірте метрики застосунку
curl -s https://api.award-system.edu.ua/actuator/metrics/http.server.requests | jq
```

**Рішення за причиною:**

| Причина | Індикатор метрики | Рішення |
|---------|-------------------|---------|
| Високий CPU | >80% використання CPU | Горизонтальне масштабування |
| Тиск пам'яті | Часте GC | Збільшіть heap size |
| Вузьке місце БД | Високий час очікування з'єднань | Оптимізуйте запити, додайте індекси |

---

## Проблеми підключення

### Проблема: "Connection Refused" до API

**Діагностика:**

```bash
# Перевірте статус сервісу
kubectl get svc -n award-system
kubectl get endpoints award-backend -n award-system

# Перевірте ingress
kubectl get ingress -n award-system
```

### Проблема: Помилки підключення до бази даних

```bash
# Тест підключення до БД
kubectl exec -it <app-pod> -- nc -zv postgres-service 5432

# Перевірте pod бази даних
kubectl get pods -l app=postgres -n award-system
```

---

## Проблеми завантаження файлів

### Проблема: "413 Request Entity Too Large"

**Причина:** Файл перевищує максимальний розмір завантаження (10MB за замовчуванням)

**Рішення:**
1. Стисніть файл перед завантаженням
2. Розділіть великі документи на кілька файлів
3. Зверніться до адміністратора, якщо потрібні більші файли

### Проблема: "415 Unsupported Media Type"

**Причина:** Формат файлу не дозволений

**Дозволені формати:**
- Документи: PDF
- Зображення: JPEG, PNG
- Максимальний розмір: 10MB

---

## Коди помилок

| Код | Значення | Дія |
|-----|----------|-----|
| 400 | Bad Request | Перевірте формат запиту |
| 401 | Unauthorized | Повторна автентифікація |
| 403 | Forbidden | Перевірте права доступу |
| 404 | Not Found | Перевірте існування ресурсу |
| 409 | Conflict | Одночасна модифікація - повторіть |
| 413 | Payload Too Large | Зменшіть розмір файлу |
| 429 | Too Many Requests | Зачекайте та повторіть |
| 500 | Server Error | Перевірте логи |
| 503 | Service Unavailable | Сервіс запускається/перевантажений |

---

## Отримання допомоги

1. **Самообслуговування**: Перегляньте цей посібник та [FAQ](#коди-помилок)
2. **Документація**: Див. [Посібник користувача](../user/USER_GUIDE_ua.md)
3. **Підтримка**: Зверніться на support@award-system.edu.ua
4. **Термінові питання**: Див. [Runbook реагування на інциденти](./runbooks/INCIDENT_RESPONSE_RUNBOOK_ua.md)

---

## Пов'язані документи

- [Посібник користувача](../user/USER_GUIDE_ua.md)
- [Посібник адміністратора](../user/ADMIN_GUIDE_ua.md)
- [Runbook розгортання](./runbooks/DEPLOYMENT_RUNBOOK_ua.md)
- [Моніторинг та спостережуваність](../monitoring/MONITORING_OBSERVABILITY_ua.md)

